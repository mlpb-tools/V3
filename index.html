<!DOCTYPE html> 
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>🎮 GAME OF JOBS - Forum de l'Emploi</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&display=swap');

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 0;
    font-family: 'Nunito', Arial, sans-serif;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    background-image:
        radial-gradient(circle at 20% 80%, rgba(23,23,24,0.03) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(243,146,0,0.05) 0%, transparent 50%),
        linear-gradient(45deg, transparent 49%, rgba(23,23,24,0.02) 50%, transparent 51%);
    color: #171718;
    overflow-x: hidden;
    line-height: 1.6;
    position: relative;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background:
        repeating-linear-gradient(90deg, transparent, transparent 98px, rgba(23,23,24,0.01) 100px),
        repeating-linear-gradient(0deg, transparent, transparent 98px, rgba(23,23,24,0.01) 100px);
    pointer-events: none;
    z-index: -1;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.header {
    text-align: center;
    background: linear-gradient(135deg, #171718 0%, #2c2c2e 100%);
    color: white;
    padding: 60px 40px;
    border: none;
    margin-bottom: 30px;
    position: relative;
    overflow: hidden;
    border-radius: 0;
    box-shadow: 0 8px 32px rgba(23,23,24,0.4), inset 0 1px 0 rgba(255,255,255,0.1);
}

.header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background:
        linear-gradient(45deg, transparent 30%, rgba(243,146,0,0.1) 50%, transparent 70%),
        repeating-linear-gradient(-45deg, transparent, transparent 20px, rgba(255,255,255,0.02) 22px);
    z-index: 1;
}

.header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 6px;
    background: linear-gradient(90deg, #f39200 0%, #95c11f 25%, #2897d5 50%, #d60b52 75%, #a3195b 100%);
    z-index: 3;
}

.header h1 {
    font-family: 'Oswald', Arial, sans-serif;
    font-size: 3.8rem;
    font-weight: 700;
    margin: 0 0 20px 0;
    position: relative;
    z-index: 2;
    letter-spacing: 0.05em;
    color: #f39200;
    text-transform: uppercase;
    text-shadow: 3px 3px 0 #171718, 6px 6px 0 rgba(23,23,24,0.3), 0 0 30px rgba(243,146,0,0.5);
    transform: perspective(500px) rotateX(15deg);
}

.header .subtitle {
    font-size: 1.1rem;
    margin: 25px 0 20px 0;
    position: relative;
    z-index: 2;
    line-height: 1.5;
    font-weight: 600;
    color: white;
}

.header .subtitle div {
    margin: 10px 0;
    padding: 15px 25px;
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    border-radius: 0;
    display: inline-block;
    color: white;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2), inset 0 1px 0 rgba(255,255,255,0.1);
    border: none;
    border-left: 6px solid #d60b52;
    backdrop-filter: blur(10px);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.02em;
}

.header .subtitle div:nth-child(2) {
    border-left-color: #2897d5;
    margin-left: 15px;
    transform: rotate(-1deg);
}

.header .subtitle div:nth-child(3) {
    border-left-color: #95c11f;
    margin-left: 30px;
    transform: rotate(1deg);
}

.header p {
    font-size: 1.1rem;
    margin: 20px 0 0 0;
    position: relative;
    z-index: 2;
    color: #171718;
    font-weight: 600;
    background: #f8f9fa;
    padding: 15px 30px;
    display: inline-block;
    border-radius: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    border: 2px solid #f39200;
}

.navigation {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 30px;
    flex-wrap: wrap;
    padding: 20px;
    background: linear-gradient(135deg, rgba(23,23,24,0.8) 0%, rgba(44,44,46,0.8) 100%);
    backdrop-filter: blur(10px);
    border-top: 3px solid #f39200;
    border-bottom: 3px solid #f39200;
}

.nav-btn {
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    border: 2px solid rgba(255,255,255,0.2);
    color: white;
    padding: 16px 24px;
    border-radius: 0;
    cursor: pointer;
    font-weight: 700;
    font-family: 'Oswald', Arial, sans-serif;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    position: relative;
    overflow: hidden;
}

.nav-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(243,146,0,0.3), transparent);
    transition: left 0.5s ease;
}

.nav-btn:hover::before {
    left: 100%;
}

.nav-btn:hover,
.nav-btn.active {
    background: linear-gradient(135deg, #f39200 0%, #d17a00 100%);
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(243,146,0,0.4), 0 0 20px rgba(243,146,0,0.3);
    border-color: #171718;
}

.page {
    display: none;
    background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.95) 100%);
    border-radius: 0;
    padding: 40px;
    box-shadow: 0 12px 40px rgba(23,23,24,0.15), inset 0 1px 0 rgba(255,255,255,0.8);
    margin-bottom: 30px;
    border: none;
    border-left: 8px solid #f39200;
    position: relative;
    backdrop-filter: blur(10px);
}

.page::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, #f39200 0%, #95c11f 25%, #2897d5 50%, #d60b52 75%, #a3195b 100%);
}

.page.active {
    display: block;
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes gentleFloat {
    0%, 100% {
        transform: translateY(0px);
    }
    50% {
        transform: translateY(-5px);
    }
}

.sector-card {
    background: linear-gradient(135deg, #f39200 0%, #d17a00 100%);
    color: white;
    border: 3px solid #171718;
    border-radius: 15px;
    padding: 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(243,146,0,0.3);
    position: relative;
}

.sector-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(243,146,0,0.5);
}

.sector-card .sector-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
    text-align: center;
}

.sector-card h4 {
    margin: 0 0 10px 0;
    font-size: 1.1rem;
    font-weight: 700;
    text-align: center;
}

.sector-card .company-count {
    text-align: center;
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 10px;
}

.sector-card .add-company-btn {
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.5);
    color: white;
    padding: 6px 12px;
    border-radius: 10px;
    cursor: pointer;
    font-size: 0.85rem;
    width: 100%;
    margin-top: 10px;
    transition: all 0.3s ease;
}

.sector-card .add-company-btn:hover {
    background: rgba(255,255,255,0.3);
}

.objective-card {
    background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,249,250,0.9) 100%);
    border: 3px solid #171718;
    border-radius: 15px;
    padding: 25px;
    text-align: center;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 6px 20px rgba(23,23,24,0.2), inset 0 1px 0 rgba(255,255,255,0.8);
    position: relative;
    overflow: hidden;
}

.objective-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(243,146,0,0.1), transparent);
    transition: left 0.6s ease;
}

.objective-card:hover::before {
    left: 100%;
}

.objective-card:hover {
    border-color: #f39200;
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 12px 35px rgba(243,146,0,0.3), 0 0 20px rgba(243,146,0,0.2);
}

.objective-card.completed {
    background: linear-gradient(135deg, #95c11f 0%, #7ba518 100%);
    color: white;
    border-color: #171718;
    box-shadow: 0 8px 30px rgba(149,193,31,0.4), 0 0 25px rgba(149,193,31,0.3);
}

.objective-icon {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.objective-card h4 {
    margin: 10px 0;
    font-size: 1.1rem;
}

.objective-points {
    font-size: 1.3rem;
    font-weight: 700;
    color: #f39200;
    margin: 10px 0;
}

.objective-card.completed .objective-points {
    color: white;
}

.objective-status {
    font-size: 0.9rem;
    padding: 8px 15px;
    border-radius: 15px;
    background: #f8f9fa;
    color: #6c757d;
    display: inline-block;
    margin-top: 10px;
}

.objective-card.completed .objective-status {
    background: rgba(255,255,255,0.2);
    color: white;
}

.btn-primary {
    background: linear-gradient(135deg, #f39200 0%, #d17a00 100%);
    color: white;
    border: 3px solid #171718;
    padding: 18px 36px;
    border-radius: 0;
    font-weight: 700;
    font-family: 'Oswald', Arial, sans-serif;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    box-shadow: 0 8px 25px rgba(243,146,0,0.3), inset 0 1px 0 rgba(255,255,255,0.2);
    font-size: 1rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    position: relative;
    overflow: hidden;
}

.btn-primary::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
    transition: left 0.6s ease;
}

.btn-primary:hover::before {
    left: 100%;
}

.btn-primary:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 12px 35px rgba(243,146,0,0.4), 0 0 30px rgba(243,146,0,0.3);
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: radial-gradient(circle at center, rgba(23,23,24,0.8) 0%, rgba(23,23,24,0.9) 100%),
                repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(243,146,0,0.05) 22px);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    backdrop-filter: blur(10px);
}

.modal.active {
    display: flex;
}

.modal-content {
    background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(248,249,250,0.95) 100%);
    padding: 40px;
    border-radius: 0;
    max-width: 600px;
    width: 90%;
    text-align: center;
    max-height: 80vh;
    overflow-y: auto;
    border: 4px solid #171718;
    box-shadow: 0 20px 60px rgba(23,23,24,0.5), inset 0 1px 0 rgba(255,255,255,0.8);
    position: relative;
    backdrop-filter: blur(20px);
}

.modal-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 6px;
    background: linear-gradient(90deg, #f39200 0%, #95c11f 25%, #2897d5 50%, #d60b52 75%, #a3195b 100%);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 25px;
    margin: 20px 0;
}

.stat-card {
    background: linear-gradient(135deg, rgba(255,255,255,0.9) 0%, rgba(248,249,250,0.9) 100%);
    border-radius: 0;
    padding: 25px;
    text-align: center;
    box-shadow: 0 8px 25px rgba(23,23,24,0.15), inset 0 1px 0 rgba(255,255,255,0.8);
    border: 3px solid #171718;
    border-top: 8px solid #f39200;
    position: relative;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    overflow: hidden;
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(45deg, transparent, transparent 15px, rgba(243,146,0,0.03) 17px);
    pointer-events: none;
}

.stat-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 0 15px 40px rgba(23,23,24,0.2), 0 0 25px rgba(243,146,0,0.2);
}

.icon-large {
    font-size: 3rem;
    margin-bottom: 10px;
    display: block;
}

.score-display {
    background: linear-gradient(135deg, #171718 0%, #2c2c2e 100%);
    color: white;
    padding: 40px;
    border-radius: 0;
    text-align: center;
    margin: 20px 0;
    border: 4px solid #f39200;
    box-shadow: 0 12px 40px rgba(23,23,24,0.3), inset 0 1px 0 rgba(255,255,255,0.1);
    position: relative;
    overflow: hidden;
}

.score-display::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(-45deg, transparent, transparent 25px, rgba(243,146,0,0.05) 27px);
    pointer-events: none;
}

.score-number {
    font-family: 'Oswald', Arial, sans-serif;
    font-size: 4rem;
    font-weight: 700;
    margin: 15px 0;
    text-shadow: 2px 2px 0 rgba(0,0,0,0.3), 0 0 20px rgba(243,146,0,0.5);
    color: #f39200;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    .header {
        padding: 30px 20px;
    }
    .header h1 {
        font-size: 2rem;
    }
    .header .subtitle {
        font-size: 1rem;
    }
    .header .subtitle div {
        display: block;
        margin: 8px auto;
        padding: 10px 15px;
        max-width: 280px;
    }
    .navigation {
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    .nav-btn {
        width: 100%;
        max-width: 300px;
        padding: 12px 20px;
        font-size: 0.9rem;
    }
    .stats-grid {
        grid-template-columns: 1fr;
        gap: 15px;
    }
    .modal-content {
        width: 95%;
        padding: 20px;
        max-height: 90vh;
    }
}
</style>
</head>
<body>
<div class="container">
    <header class="header">
        <!-- Logo en haut à gauche -->
        <div style="position: absolute; top: 20px; left: 20px; z-index: 3;">
            <img src="https://static.wixstatic.com/media/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif/v1/fill/w_224,h_60,al_c,q_80,enc_avif,quality_auto/dd5dab_47743b1c86024865ba19e623a3db327f~mv2.avif"
                 alt="Logo Mission Locale"
                 style="height: 50px; width: auto; background: rgba(255,255,255,0.95); padding: 8px 12px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);"
                 onerror="this.style.display='none';">
        </div>

        <!-- Sélecteur de langue en haut à droite -->
        <div style="position: absolute; top: 20px; right: 20px; z-index: 3; display: flex; gap: 5px;">
            <button onclick="changeLanguage('fr')" id="langFr"
                    style="background: linear-gradient(135deg, #f39200 0%, #d17a00 100%); color: white; border: 2px solid #171718; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(243,146,0,0.3);">
                🇫🇷 FR
            </button>
            <button onclick="changeLanguage('es')" id="langEs"
                    style="background: rgba(255,255,255,0.9); color: #171718; border: 2px solid #171718; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                🇪🇸 ES
            </button>
        </div>

        <h1 data-translate="title">GAME OF JOBS</h1>

        <div class="subtitle">
            <div data-translate="subtitle1">🇫🇷 <strong>Trouve ton job</strong></div>
            <div data-translate="subtitle2">🇪🇸 <strong>¡Encuentra tu trabajo!</strong></div>
            <div data-translate="subtitle3">🇪🇺 <strong>Aurkitu zure lana !</strong></div>
        </div>

        <p data-translate="forum_title">Forum de l'Emploi - Réseau des Missions Locales</p>
    </header>

    <nav class="navigation">
        <button class="nav-btn active" onclick="showPage('map')" data-translate="nav_map">🗺️ Carte Interactive</button>
        <button class="nav-btn" onclick="showPage('rules')" data-translate="nav_rules">📋 Règles du Jeu</button>
        <button class="nav-btn" onclick="showPage('progress')" data-translate="nav_progress">📊 Mon Parcours</button>
        <button class="nav-btn" onclick="showPage('questions')" data-translate="nav_questions">❓ Questions Fréquentes</button>
        <button class="nav-btn" onclick="showPage('rewards')" data-translate="nav_rewards">🏆 Récompenses</button>
    </nav>

    <!-- Page 1: Carte Interactive -->
    <div id="map" class="page active">
        <!-- Score et progression -->
        <div style="background: linear-gradient(135deg, #f39200 0%, #95c11f 100%); color: white; padding: 20px; border-radius: 15px; margin-bottom: 30px; text-align: center;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                <div>
                    <h3 style="margin: 0; font-family: 'Inter', sans-serif; font-size: 1.5rem;" data-translate="total_score">Score Total</h3>
                    <div id="totalScore" style="font-size: 2.5rem; font-weight: 700; margin: 5px 0;">0</div>
                </div>
                <div style="flex: 1; min-width: 200px;">
                    <div style="background: rgba(255,255,255,0.2); border-radius: 10px; height: 20px; margin: 10px 0;">
                        <div id="globalProgress" style="background: white; height: 100%; border-radius: 10px; width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <small data-translate="general_progress">Progression générale : 0%</small>
                </div>
            </div>
        </div>

        <!-- Bandeau secteurs -->
        <div id="sectorsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px;">
            <!-- Les secteurs seront ajoutés dynamiquement -->
        </div>

        <!-- Boutons d'action -->
        <div style="display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
            <button onclick="openCVOptions()" class="btn-primary" data-translate="btn_cv">📄 Mon CV</button>
            <button onclick="openChat()" class="btn-primary" data-translate="btn_help">💬 Aide / Chat QG</button>
            <button onclick="addNewSector()" class="btn-primary" data-translate="btn_new_sector">➕ Nouveau Secteur</button>
        </div>

        <h2 style="color: #f39200; font-size: 2.5rem; margin-bottom: 10px; text-align: center;" data-translate="main_title">🗺️ Ta mission commence ici !</h2>
        <p style="text-align: center; font-size: 1.2rem; color: #171718; margin-bottom: 30px;" data-translate="main_subtitle">Explore le Forum de l'Emploi et découvre toutes les opportunités qui t'attendent</p>

        <!-- QG Mission Locale -->
        <div style="text-align: center; margin: 30px 0;">
            <div id="qg" onclick="openQG()" style="background: linear-gradient(135deg, #2897d5 0%, #95c11f 100%); color: white; padding: 30px; border-radius: 25px; border: 3px solid rgba(255,255,255,0.3); cursor: pointer; box-shadow: 0 10px 30px rgba(40,151,213,0.2); display: inline-block; position: relative; min-width: 250px;">
                <div style="font-size: 2.5rem; margin-bottom: 10px;">🏠</div>
                <h3 style="margin: 0; font-size: 1.2rem;">STAND</h3>
                <h3 style="margin: 0; font-size: 1.2rem;" data-translate="qg_title">MISSION LOCALE</h3>
                <p style="margin: 5px 0 0 0; font-size: 0.9rem; opacity: 0.9;" data-translate="qg_subtitle">(QG)</p>
            </div>
        </div>

        <!-- Objectifs -->
        <div style="background: white; border: 2px solid #171718; border-radius: 15px; padding: 25px; margin-top: 30px;">
            <h3 style="color: #f39200; margin-bottom: 20px; text-align: center;" data-translate="objectives_title">🏆 Tes Objectifs Points</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div class="objective-card" id="obj_presence" onclick="completeObjective('presence')">
                    <div class="objective-icon">✅</div>
                    <h4 data-translate="presence_obj">Feuille de présence signée</h4>
                    <div class="objective-points">+10 pts</div>
                    <div class="objective-status" data-translate="todo_status">À faire</div>
                </div>
                <div class="objective-card" id="obj_secteurs" onclick="completeObjective('secteurs')">
                    <div class="objective-icon">🧭</div>
<h4 data-translate="sectors_obj">3 secteurs ciblés</h4>
                    <div class="objective-points">+10 pts</div>
                    <div class="objective-status" data-translate="todo_status">À faire</div>
                </div>
                <div class="objective-card" id="obj_debrief" onclick="completeObjective('debrief')">
                    <div class="objective-icon">🎤</div>
                    <h4 data-translate="debrief_obj">Débrief retour QG</h4>
                    <div class="objective-points">+20 pts</div>
                    <div class="objective-status" data-translate="todo_status">À faire</div>
                </div>
                <div class="objective-card" id="obj_partenaire" onclick="completeObjective('partenaire')">
                    <div class="objective-icon">💫</div>
                    <h4 data-translate="partner_obj">Visite partenaire ML</h4>
                    <div class="objective-points">+100 pts</div>
                    <div class="objective-status" data-translate="todo_status">À faire</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 2: Règles du Jeu -->
    <div id="rules" class="page">
        <h2 style="color: #f39200; font-size: 2.5rem; margin-bottom: 30px; text-align: center;">📋 Règles du Jeu</h2>

        <div style="background: linear-gradient(135deg, #2897d5 0%, #95c11f 100%); color: white; padding: 30px; border-radius: 20px; margin-bottom: 30px;">
            <h3 style="text-align: center; margin-bottom: 20px;">🎯 Objectif Principal</h3>
            <p style="font-size: 1.2rem; text-align: center; margin: 0;">Explore le forum, rencontre des recruteurs, pose des questions et décroche ton job de rêve !</p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 25px; margin-bottom: 30px;">
            <div style="background: white; border: 3px solid #f39200; border-radius: 15px; padding: 25px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">🎮</div>
                    <h3 style="color: #f39200; margin: 0;">Comment Jouer</h3>
                </div>
                <ul style="list-style: none; padding: 0; margin: 0;">
                    <li style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong>1.</strong> Clique sur les secteurs pour les explorer
                    </li>
                    <li style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong>2.</strong> Rencontre les recruteurs et pose des questions
                    </li>
                    <li style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong>3.</strong> Dépose ton CV dans les entreprises
                    </li>
                    <li style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong>4.</strong> Accumule des points et débloque des badges
                    </li>
                </ul>
            </div>

            <div style="background: white; border: 3px solid #95c11f; border-radius: 15px; padding: 25px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">⭐</div>
                    <h3 style="color: #95c11f; margin: 0;">Système de Points</h3>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <span>Visite d'un secteur</span>
                        <span style="font-weight: bold; color: #f39200;">+20 pts</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <span>Question posée</span>
                        <span style="font-weight: bold; color: #f39200;">+50 pts</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <span>CV déposé</span>
                        <span style="font-weight: bold; color: #f39200;">+100 pts</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <span>Contact obtenu</span>
                        <span style="font-weight: bold; color: #f39200;">+200 pts</span>
                    </div>
                </div>
            </div>

            <div style="background: white; border: 3px solid #2897d5; border-radius: 15px; padding: 25px;">
                <div style="text-align: center; margin-bottom: 20px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">🏆</div>
                    <h3 style="color: #2897d5; margin: 0;">Badges à Débloquer</h3>
                </div>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-weight: bold;">🧭 Explorateur</div>
                        <div style="font-size: 0.9rem; color: #6c757d;">Visite 3 secteurs différents</div>
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-weight: bold;">💬 Communicateur</div>
                        <div style="font-size: 0.9rem; color: #6c757d;">Pose 5 questions aux recruteurs</div>
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-weight: bold;">📄 Candidat Pro</div>
                        <div style="font-size: 0.9rem; color: #6c757d;">Dépose ton CV dans 3 entreprises</div>
                    </div>
                    <div style="padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <div style="font-weight: bold;">🌟 Job Hunter</div>
                        <div style="font-size: 0.9rem; color: #6c757d;">Obtiens un contact ou entretien</div>
                    </div>
                </div>
            </div>
        </div>

        <div style="background: #f8f9fa; border: 2px solid #171718; border-radius: 15px; padding: 25px;">
            <h3 style="color: #a3195b; text-align: center; margin-bottom: 20px;">🏆 Badges Détaillés</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div style="background: linear-gradient(135deg, #95c11f 0%, #7ba518 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">🧭</div>
                    <h4 style="margin: 0 0 10px 0;">Explorateur</h4>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Visite 3 secteurs différents</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; margin-top: 15px; font-weight: 600;">+60 points</div>
                </div>

                <div style="background: linear-gradient(135deg, #2897d5 0%, #1e7bb8 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">💬</div>
                    <h4 style="margin: 0 0 10px 0;">Communicateur</h4>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Pose 5 questions aux recruteurs</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; margin-top: 15px; font-weight: 600;">+250 points</div>
                </div>

                <div style="background: linear-gradient(135deg, #f39200 0%, #d17a00 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">📄</div>
                    <h4 style="margin: 0 0 10px 0;">Candidat Pro</h4>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Dépose ton CV dans 3 entreprises</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; margin-top: 15px; font-weight: 600;">+300 points</div>
                </div>

                <div style="background: linear-gradient(135deg, #a3195b 0%, #8a1449 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">🌟</div>
                    <h4 style="margin: 0 0 10px 0;">Job Hunter</h4>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Obtiens un contact ou entretien</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; margin-top: 15px; font-weight: 600;">+500 points</div>
                </div>

                <div style="background: linear-gradient(135deg, #95c11f 0%, #2897d5 100%); color: white; padding: 20px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">🌱</div>
                    <h4 style="margin: 0 0 10px 0;">Eco Warrior</h4>
                    <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">Complète 5000 pas pendant le forum</p>
                    <div style="background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 20px; margin-top: 15px; font-weight: 600;">+150 points</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Page 3: Mon Parcours -->
    <div id="progress" class="page">
        <h2 style="color: #f39200; font-size: 2.5rem; margin-bottom: 30px; text-align: center;">📊 Mon Parcours</h2>

        <div class="score-display">
            <h3 style="margin: 0 0 15px 0;">🎯 Ton Score Actuel</h3>
            <div class="score-number" id="currentScore">0</div>
            <div style="font-size: 1.2rem; margin-bottom: 20px;">points obtenus</div>
            <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 15px;">
                <div style="font-weight: 600; margin-bottom: 10px;">Progression Générale</div>
                <div style="background: rgba(255,255,255,0.3); border-radius: 10px; height: 20px; margin: 10px 0;">
                    <div id="progressBar" style="background: white; height: 100%; border-radius: 10px; width: 0%; transition: width 0.5s ease;"></div>
                </div>
                <div id="progressText" style="font-size: 0.9rem; opacity: 0.9;">0% de ton objectif atteint</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon-large">🏢</div>
                <h3 style="color: #f39200; margin: 10px 0;">Secteurs Visités</h3>
                <div style="font-size: 2rem; font-weight: 700; color: #171718;" id="sectorsCount">0</div>
                <div style="color: #6c757d; font-size: 0.9rem;">secteurs explorés</div>
            </div>

            <div class="stat-card">
                <div class="icon-large">💬</div>
                <h3 style="color: #2897d5; margin: 10px 0;">Questions Posées</h3>
                <div style="font-size: 2rem; font-weight: 700; color: #171718;" id="questionsCount">0</div>
                <div style="color: #6c757d; font-size: 0.9rem;">interactions réalisées</div>
            </div>

            <div class="stat-card">
                <div class="icon-large">📄</div>
                <h3 style="color: #95c11f; margin: 10px 0;">CV Déposés</h3>
                <div style="font-size: 2rem; font-weight: 700; color: #171718;" id="cvsCount">0</div>
                <div style="color: #6c757d; font-size: 0.9rem;">candidatures actives</div>
            </div>

            <div class="stat-card">
                <div class="icon-large">⭐</div>
                <h3 style="color: #a3195b; margin: 10px 0;">Badges Obtenus</h3>
                <div style="font-size: 2rem; font-weight: 700; color: #171718;" id="badgesCount">0</div>
                <div style="color: #6c757d; font-size: 0.9rem;">sur 5 possibles</div>
            </div>
        </div>

        <!-- Badges -->
        <div style="background: white; border: 2px solid #171718; border-radius: 15px; padding: 25px; margin: 30px 0;">
            <h3 style="color: #2897d5; text-align: center; margin-bottom: 25px;">🏆 Tes Badges</h3>
            <div id="badgesDisplay" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <!-- Les badges seront ajoutés dynamiquement -->
            </div>
        </div>

        <!-- Badge Eco Warrior avec saisie manuelle des pas -->
        <div style="background: white; border: 2px solid #171718; border-radius: 15px; padding: 25px; margin: 30px 0;">
            <h3 style="color: #95c11f; text-align: center; margin-bottom: 20px;">🌱 Badge Eco Warrior</h3>
            <div style="text-align: center;">
                <p style="margin-bottom: 20px;">Enregistre ton nombre de pas pour débloquer le badge Eco Warrior !</p>
                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; max-width: 400px; margin: 0 auto;">
                    <div style="font-size: 2rem; margin-bottom: 10px;">👟</div>
                    <div style="font-size: 2.5rem; font-weight: 700; color: #95c11f; margin: 10px 0;" id="stepsCount">0</div>
                    <div style="color: #6c757d; margin-bottom: 15px;">/ 5000 pas</div>
                    <div style="background: #e9ecef; border-radius: 10px; height: 12px; margin: 15px 0;">
                        <div id="stepsProgress" style="background: linear-gradient(135deg, #95c11f 0%, #7ba518 100%); height: 100%; border-radius: 10px; width: 0%; transition: width 0.5s ease;"></div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <input type="number" id="stepsInput" placeholder="Nombre de pas" min="0" style="flex: 1; padding: 12px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1rem;">
                        <button onclick="updateSteps()" style="background: #95c11f; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; white-space: nowrap;">
                            Enregistrer
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Carnet de bord -->
        <div style="background: white; border: 2px solid #171718; border-radius: 15px; padding: 25px; margin: 30px 0;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; flex-wrap: wrap; gap: 15px;">
                <h3 style="color: #f39200; margin: 0;">📋 Mon Carnet de Bord</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button onclick="addCompanyToTracker()" style="background: linear-gradient(135deg, #95c11f 0%, #7ba518 100%); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 6px 20px rgba(149,193,31,0.4); transition: all 0.3s ease;">
                        ➕ Ajouter une entreprise
                    </button>
                    <button onclick="clearAllTracking()" style="background: linear-gradient(135deg, #d60b52 0%, #b8094a 100%); color: white; border: none; padding: 12px 25px; border-radius: 25px; cursor: pointer; font-weight: 600; box-shadow: 0 6px 20px rgba(214,11,82,0.4); transition: all 0.3s ease;">
                        🗑️ Effacer tout
                    </button>
                </div>
            </div>

            <div style="overflow-x: auto; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <table id="companyTracker" style="width: 100%; border-collapse: collapse; background: white; min-width: 800px;">
                    <thead>
                        <tr style="background: linear-gradient(135deg, #f39200 0%, #95c11f 100%); color: white;">
                            <th style="padding: 15px; text-align: left; font-weight: 600; border-bottom: 2px solid #171718;">Entreprise</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600; border-bottom: 2px solid #171718; min-width: 120px;">👋 Présentation</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600; border-bottom: 2px solid #171718; min-width: 120px;">💬 Question posée</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600; border-bottom: 2px solid #171718; min-width: 120px;">📄 CV déposé</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600; border-bottom: 2px solid #171718; min-width: 120px;">📞 Suivi obtenu</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600; border-bottom: 2px solid #171718; min-width: 200px;">😃 Ressenti</th>
                            <th style="padding: 15px; text-align: center; font-weight: 600; border-bottom: 2px solid #171718; width: 80px;">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="trackerBody">
                        <!-- Les lignes seront ajoutées dynamiquement -->
                    </tbody>
                </table>
            </div>

            <div id="emptyTracker" style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 10px; margin-top: 20px;">
                <div style="font-size: 3rem; margin-bottom: 15px;">📝</div>
                <h4 style="color: #6c757d; margin: 0 0 10px 0;">Ton carnet de bord est vide</h4>
                <p style="color: #6c757d; margin: 0 0 20px 0;">Commence à ajouter les entreprises que tu rencontres pour suivre tes démarches !</p>
                <button onclick="addCompanyToTracker()" style="background: #95c11f; color: white; border: none; padding: 12px 25px; border-radius: 20px; cursor: pointer; font-weight: 600;">
                    ➕ Ajouter ma première entreprise
                </button>
            </div>
        </div>

        <!-- Prochains objectifs -->
        <div style="background: linear-gradient(135deg, #a3195b 0%, #8a1449 100%); color: white; border-radius: 15px; padding: 25px;">
            <h3 style="text-align: center; margin-bottom: 20px;">🎯 Prochains Objectifs</h3>
            <div id="nextObjectives" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <!-- Les objectifs seront ajoutés dynamiquement -->
            </div>
        </div>
    </div>

    <!-- Page 4: Questions Fréquentes -->
    <div id="questions" class="page">
        <h2 style="color: #f39200; font-size: 2.5rem; margin-bottom: 30px; text-align: center;">❓ Questions à Poser aux Recruteurs</h2>

        <div style="background: linear-gradient(135deg, #2897d5 0%, #95c11f 100%); color: white; padding: 25px; border-radius: 20px; margin-bottom: 30px; text-align: center;">
            <h3 style="margin-bottom: 15px;">💡 Brise la Glace !</h3>
            <p style="margin: 0; font-size: 1.1rem;">Ces questions t'aident à briser la glace avec un recruteur !</p>
            <p style="margin: 10px 0 0 0; font-size: 0.9rem; opacity: 0.9;">Clique sur une question pour la copier et l'utiliser 📋</p>
        </div>

        <!-- Questions prédéfinies -->
        <div id="questionsGrid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <!-- Les questions seront ajoutées dynamiquement -->
        </div>

        <!-- Zone questions personnelles -->
        <div style="background: white; border: 2px solid #171718; border-radius: 15px; padding: 25px; margin-bottom: 30px;">
            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <div style="font-size: 2rem;">✏️</div>
                <h3 style="color: #f39200; margin: 0;">Mes Questions Personnelles</h3>
            </div>
            <p style="color: #6c757d; margin-bottom: 20px;">Note ici tes propres questions selon ton profil et tes intérêts :</p>
            <div id="personalQuestions" style="display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px;">
                <!-- Les questions personnelles seront ajoutées ici -->
            </div>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <input type="text" id="newPersonalQuestion" placeholder="Ex: Proposez-vous des formations en interne ?" style="flex: 1; min-width: 250px; padding: 12px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 1rem;">
                <button onclick="addPersonalQuestion()" style="background: #95c11f; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; white-space: nowrap;">
                    ➕ Ajouter
                </button>
            </div>
        </div>
    </div>

    <!-- Page 5: Récompenses -->
    <div id="rewards" class="page">
        <h2 style="color: #f39200; font-size: 2.5rem; margin-bottom: 30px; text-align: center;">🏆 Récompenses</h2>

        <div class="score-display">
            <h3 style="margin: 0 0 15px 0;">🎯 Ton Score Final</h3>
            <div class="score-number" id="finalScore">0</div>
            <div style="font-size: 1.2rem; margin-bottom: 20px;">points obtenus</div>
        </div>

        <div style="background: white; border: 2px solid #171718; border-radius: 15px; padding: 25px; margin-bottom: 30px;">
            <h3 style="color: #f39200; text-align: center; margin-bottom: 25px;">🏅 Tes Badges Obtenus</h3>
            <div id="rewardsBadgesDisplay" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <!-- Les badges seront affichés ici -->
            </div>
        </div>

        <div style="background: linear-gradient(135deg, #a3195b 0%, #8a1449 100%); color: white; border-radius: 15px; padding: 25px; margin-bottom: 30px;">
            <h3 style="text-align: center; margin-bottom: 20px;">🎁 Tes Récompenses</h3>
            <div style="display: flex; justify-content: center;">
                <div style="background: rgba(255,255,255,0.1); padding: 30px; border-radius: 15px; text-align: center; max-width: 400px;">
                    <div style="font-size: 3rem; margin-bottom: 20px;">📊</div>
                    <h4 style="margin: 0 0 15px 0; font-size: 1.3rem;">Mon Bilan Personnalisé</h4>
                    <p style="margin: 0 0 20px 0; font-size: 1rem; opacity: 0.9;">Récapitulatif complet de ton parcours au forum emploi</p>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button onclick="downloadBilan()" style="background: white; color: #a3195b; border: none; padding: 12px 25px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 1rem;">
                            📄 Télécharger en PDF
                        </button>
                        <button onclick="emailBilan()" style="background: rgba(255,255,255,0.2); color: white; border: 2px solid white; padding: 12px 25px; border-radius: 20px; cursor: pointer; font-weight: 600; font-size: 1rem;">
                            📧 Envoyer par Email
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div style="background: white; border: 2px solid #171718; border-radius: 15px; padding: 25px;">
            <h3 style="color: #2897d5; text-align: center; margin-bottom: 25px;">🚀 Prochaines Étapes</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius; border-left: 4px solid #f39200;">
                    <h4 style="margin: 0 0 10px 0; color: #f39200;">Cette Semaine</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #171718;">
                        <li>Recontacter les entreprises visitées</li>
                        <li>Envoyer des emails de remerciement</li>
                        <li>Préparer les entretiens éventuels</li>
                    </ul>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 4px solid #95c11f;">
                    <h4 style="margin: 0 0 10px 0; color: #95c11f;">Semaine Prochaine</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #171718;">
                        <li>RDV bilan avec ton conseiller</li>
                        <li>Relancer les candidatures</li>
                        <li>Rechercher d'autres opportunités</li>
                    </ul>
                </div>

                <div style="background: #f8f9fa; padding: 20px; border-radius: 15px; border-left: 4px solid #2897d5;">
                    <h4 style="margin: 0 0 10px 0; color: #2897d5;">Ce Mois-ci</h4>
                    <ul style="margin: 0; padding-left: 20px; color: #171718;">
                        <li>Candidatures ciblées</li>
                        <li>Entretiens et immersions</li>
                        <li>Suivi des réponses</li>
                    </ul>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, #f39200 0%, #95c11f 100%); color: white; padding: 20px; border-radius: 15px; margin-top: 25px; text-align: center;">
                <h4 style="margin: 0 0 15px 0;">🎉 Félicitations !</h4>
                <p style="margin: 0 0 20px 0; font-size: 1.1rem;">Tu as terminé ton parcours au forum emploi. Continue sur cette lancée et n'hésite pas à revenir vers nous si tu as besoin d'aide !</p>
                <button onclick="saveResults()" style="background: white; color: #f39200; border: none; padding: 15px 30px; border-radius: 25px; cursor: pointer; font-weight: 700; font-size: 1.1rem; box-shadow: 0 6px 20px rgba(0,0,0,0.2); transition: all 0.3s ease;">
                    💾 Sauvegarder Mon Résultat
                </button>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modalTitle">Titre</h3>
            <div id="modalContent">Contenu</div>
            <button class="btn-primary" onclick="closeModal()">Fermer</button>
        </div>
    </div>
</div>

<script>
// =============================================================================
// SYSTÈME DE DONNÉES ET SAUVEGARDE
// =============================================================================

// Données utilisateur (sauvegardées dans localStorage)
let userData = {
    score: 0,
    visitedSectors: [],
    completedObjectives: [],
    companyTracker: [],
    personalQuestions: [],
    questionsAsked: 0,
    cvsDeposited: 0,
    contactsObtained: 0,
    stepsCount: 0,
    badges: {
        explorer: false,
        communicator: false,
        candidate: false,
        hunter: false,
        ecoWarrior: false
    }
};

// Données de l'application (secteurs et entreprises)
let appData = {
    sectors: [
        { 
            id: 'commerce', 
            name: 'Commerce', 
            icon: '🛍️', 
            color: '#f39200',
            companies: [
                { name: "SuperMarché Plus", contact: "Marie Dubois", phone: "01.23.45.67.89", email: "marie@supermarche.fr", offers: ["Vendeur H/F", "Caissier H/F"] },
                { name: "Boutique Mode", contact: "Jean Martin", phone: "01.98.76.54.32", email: "jean@mode.fr", offers: ["Conseiller de vente", "Responsable boutique"] }
            ]
        },
        { 
            id: 'industrie', 
            name: 'Industrie', 
            icon: '⚙️', 
            color: '#95c11f',
            companies: [
                { name: "TechnoFab", contact: "Sophie Laurent", phone: "01.11.22.33.44", email: "sophie@technofab.fr", offers: ["Opérateur machine", "Technicien maintenance"] }
            ]
        },
        { 
            id: 'numerique', 
            name: 'Numérique', 
            icon: '💻', 
            color: '#a3195b',
            companies: [
                { name: "WebDev Pro", contact: "Alex Dupont", phone: "01.55.66.77.88", email: "alex@webdev.fr", offers: ["Développeur Junior", "Designer UI/UX"] }
            ]
        },
        { 
            id: 'sante', 
            name: 'Santé/Social', 
            icon: '🧑⚕️', 
            color: '#2897d5',
            companies: [
                { name: "Clinique Santé+", contact: "Dr. Martin", phone: "01.44.55.66.77", email: "contact@sante.fr", offers: ["Aide-soignant", "Secrétaire médical"] }
            ]
        },
        { id: 'transport', name: 'Transport', icon: '🚛', color: '#d60b52', companies: [] },
        { id: 'hotellerie', name: 'Hôtellerie, Restauration', icon: '🍽️', color: '#9f3d3f', companies: [] },
        { id: 'animation', name: 'Animation', icon: '🎭', color: '#6f42c1', companies: [] },
        { id: 'tourisme', name: 'Tourisme', icon: '🏖️', color: '#fd7e14', companies: [] },
        { id: 'btp', name: 'BTP', icon: '🏗️', color: '#20c997', companies: [] },
        { id: 'agriculture', name: 'Agriculture', icon: '🌾', color: '#28a745', companies: [] },
        { id: 'securite', name: 'Sécurité', icon: '🛡️', color: '#6c757d', companies: [] },
        { id: 'apprentissages', name: 'Apprentissages', icon: '🎓', color: '#e83e8c', companies: [] },
        { id: 'interim', name: 'Intérim', icon: '⏰', color: '#17a2b8', companies: [] },
        { id: 'groupement', name: 'Groupement d\'Employeurs', icon: '🤝', color: '#8e44ad', companies: [] }
    ],
    predefinedQuestions: [
        { text: "Quelles qualités recherchez-vous pour ce poste ?", icon: "🎯", color: "#f39200" },
        { text: "Quels métiers recrutent le plus actuellement ?", icon: "💼", color: "#95c11f" },
        { text: "Proposez-vous des stages ou de l'alternance ?", icon: "🎓", color: "#2897d5" },
        { text: "Faut-il obligatoirement un diplôme ?", icon: "📚", color: "#a3195b" },
        { text: "Peut-on postuler sans expérience ?", icon: "🌟", color: "#d60b52" },
        { text: "Comment se déroule une journée type ?", icon: "⏰", color: "#9f3d3f" },
        { text: "Quelles sont les perspectives d'évolution ?", icon: "🚀", color: "#f39200" },
        { text: "Comment fonctionne l'équipe ?", icon: "🤝", color: "#95c11f" },
        { text: "Quels sont les horaires et la rémunération ?", icon: "💰", color: "#2897d5" },
        { text: "Comment puis-je vous recontacter ?", icon: "📞", color: "#a3195b" }
    ]
};

// Langue actuelle
let currentLanguage = 'fr';

// Traductions
const translations = {
    fr: {
        title: "GAME OF JOBS",
        subtitle1: "🇫🇷 Trouve ton job",
        subtitle2: "🇪🇸 ¡Encuentra tu trabajo!",
        subtitle3: "🇪🇺 Aurkitu zure lana !",
        forum_title: "Forum de l'Emploi - Réseau des Missions Locales",
        nav_map: "🗺️ Carte Interactive",
        nav_rules: "📋 Règles du Jeu",
        nav_progress: "📊 Mon Parcours",
        nav_questions: "❓ Questions Fréquentes",
        nav_rewards: "🏆 Récompenses",
        main_title: "🗺️ Ta mission commence ici !",
        main_subtitle: "Explore le Forum de l'Emploi et découvre toutes les opportunités qui t'attendent",
        total_score: "Score Total",
        general_progress: "Progression générale : ",
        qg_title: "MISSION LOCALE",
        qg_subtitle: "(QG)",
        objectives_title: "🏆 Tes Objectifs Points",
        presence_obj: "Feuille de présence signée",
        sectors_obj: "3 secteurs ciblés",
        debrief_obj: "Débrief retour QG",
        partner_obj: "Visite partenaire ML",
        todo_status: "À faire",
        completed_status: "Complété !",
        btn_cv: "📄 Mon CV",
        btn_help: "💬 Aide / Chat QG",
        btn_new_sector: "➕ Nouveau Secteur"
    },
    es: {
        title: "GAME OF JOBS",
        subtitle1: "🇫🇷 Encuentra tu trabajo",
        subtitle2: "🇪🇸 ¡Encuentra tu trabajo!",
        subtitle3: "🇪🇺 Aurkitu zure lana !",
        forum_title: "Foro de Empleo - Red de Misiones Locales",
        nav_map: "🗺️ Mapa Interactivo",
        nav_rules: "📋 Reglas del Juego",
        nav_progress: "📊 Mi Progreso",
        nav_questions: "❓ Preguntas Frecuentes",
        nav_rewards: "🏆 Recompensas",
        main_title: "🗺️ ¡Tu misión comienza aquí!",
        main_subtitle: "Explora el Foro de Empleo y descubre todas las oportunidades que te esperan",
        total_score: "Puntuación Total",
        general_progress: "Progreso general: ",
        qg_title: "MISIÓN LOCAL",
        qg_subtitle: "(QG)",
        objectives_title: "🏆 Tus Objetivos Puntos",
        presence_obj: "Hoja de presencia firmada",
        sectors_obj: "3 sectores objetivo",
        debrief_obj: "Informe de vuelta al QG",
        partner_obj: "Visita socio ML",
        todo_status: "Por hacer",
        completed_status: "¡Completado!",
        btn_cv: "📄 Mi CV",
        btn_help: "💬 Ayuda / Chat QG",
        btn_new_sector: "➕ Nuevo Sector"
    }
};

// =============================================================================
// INITIALISATION
// =============================================================================

document.addEventListener('DOMContentLoaded', function() {
    loadUserData();
    loadAppData();
    initializeApp();
    
    // Sauvegarder automatiquement toutes les 30 secondes
    setInterval(saveUserData, 30000);
});

function initializeApp() {
    renderSectors();
    renderQuestions();
    updateAllDisplays();
    updateBadgesDisplay();
    updateNextObjectives();
    
    // Gestion de l'input des questions personnelles avec Entrée
    const questionInput = document.getElementById('newPersonalQuestion');
    if (questionInput) {
        questionInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPersonalQuestion();
            }
        });
    }
    
    // Gestion de l'input des pas avec Entrée
    const stepsInput = document.getElementById('stepsInput');
    if (stepsInput) {
        stepsInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                updateSteps();
            }
        });
    }
}

// =============================================================================
// SAUVEGARDE ET CHARGEMENT DES DONNÉES
// =============================================================================

function saveUserData() {
    try {
        localStorage.setItem('gameOfJobsUserData', JSON.stringify(userData));
        console.log('Données sauvegardées avec succès');
    } catch (e) {
        console.error('Erreur lors de la sauvegarde:', e);
    }
}

function loadUserData() {
    try {
        const saved = localStorage.getItem('gameOfJobsUserData');
        if (saved) {
            userData = JSON.parse(saved);
            console.log('Données chargées avec succès');
        }
    } catch (e) {
        console.error('Erreur lors du chargement:', e);
    }
}

function saveAppData() {
    try {
        localStorage.setItem('gameOfJobsAppData', JSON.stringify(appData));
        console.log('Données de l\'application sauvegardées');
    } catch (e) {
        console.error('Erreur lors de la sauvegarde de l\'application:', e);
    }
}

function loadAppData() {
    try {
        const saved = localStorage.getItem('gameOfJobsAppData');
        if (saved) {
            appData = JSON.parse(saved);
            console.log('Données de l\'application chargées');
        }
    } catch (e) {
        console.error('Erreur lors du chargement de l\'application:', e);
    }
}

// =============================================================================
// NAVIGATION
// =============================================================================

function showPage(pageId) {
    // Masquer toutes les pages
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    
    // Désactiver tous les boutons
    document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    
    // Afficher la page sélectionnée
    document.getElementById(pageId).classList.add('active');
    
    // Activer le bouton correspondant
    event.target.classList.add('active');
    
    // Mettre à jour les affichages si nécessaire
    if (pageId === 'progress') {
        updateTrackerDisplay();
        updateBadgesDisplay();
    } else if (pageId === 'rewards') {
        updateRewardsBadgesDisplay();
    }
}

// =============================================================================
// RENDU DES SECTEURS
// =============================================================================

function renderSectors() {
    const grid = document.getElementById('sectorsGrid');
    grid.innerHTML = '';
    
    appData.sectors.forEach(sector => {
        const card = document.createElement('div');
        card.className = 'sector-card';
        card.style.background = `linear-gradient(135deg, ${sector.color} 0%, ${adjustBrightness(sector.color, -20)} 100%)`;
        card.onclick = () => openSector(sector.id);
        
        card.innerHTML = `
            <div class="sector-icon">${sector.icon}</div>
            <h4>${sector.name}</h4>
            <div class="company-count">${sector.companies.length} entreprise${sector.companies.length !== 1 ? 's' : ''}</div>
            <button class="add-company-btn" onclick="event.stopPropagation(); addCompanyToSector('${sector.id}')">
                ➕ Ajouter entreprise
            </button>
        `;
        
        grid.appendChild(card);
    });
}

function adjustBrightness(color, percent) {
    const num = parseInt(color.replace('#', ''), 16);
    const amt = Math.round(2.55 * percent);
    const R = (num >> 16) + amt;
    const G = (num >> 8 & 0x00FF) + amt;
    const B = (num & 0x0000FF) + amt;
    return '#' + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
        (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
        (B < 255 ? B < 1 ? 0 : B : 255))
        .toString(16).slice(1);
}

// =============================================================================
// GESTION DES SECTEURS
// =============================================================================

function openSector(sectorId) {
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    let content = `
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="color: #f39200; margin: 0;">🏢 Secteur ${sector.name}</h3>
            <button onclick="addCompanyToSector('${sectorId}')" style="background: #95c11f; color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: 600;">
                ➕ Ajouter Entreprise
            </button>
        </div>
        <p style="margin-bottom: 20px;">Découvre les entreprises et opportunités dans ce secteur !</p>
    `;
    
    if (sector.companies.length > 0) {
        content += '<div style="display: flex; flex-direction: column; gap: 15px;">';
        
        sector.companies.forEach((company, index) => {
            content += `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; border-left: 4px solid ${sector.color}; position: relative;">
                    <div style="position: absolute; top: 10px; right: 10px; display: flex; gap: 5px;">
                        <button onclick="editCompany('${sectorId}', ${index})" style="background: #2897d5; color: white; border: none; padding: 5px 8px; border-radius: 5px; cursor: pointer; font-size: 0.8rem;">✏️</button>
                        <button onclick="deleteCompany('${sectorId}', ${index})" style="background: #d60b52; color: white; border: none; padding: 5px 8px; border-radius: 5px; cursor: pointer; font-size: 0.8rem;">🗑️</button>
                    </div>
                    <h4 style="margin: 0 0 10px 0; color: #171718; padding-right: 80px;">${company.name}</h4>
                    <p style="margin: 5px 0; color: #6c757d;"><strong>Contact :</strong> ${company.contact}</p>
                    <p style="margin: 5px 0; color: #6c757d;"><strong>Téléphone :</strong> ${company.phone}</p>
                    <p style="margin: 5px 0; color: #6c757d;"><strong>Email :</strong> ${company.email}</p>
                    ${company.offers && company.offers.length > 0 ? `
                        <div style="margin: 10px 0;">
                            <strong style="color: #171718;">Offres disponibles :</strong>
                            <div style="display: flex; flex-wrap: wrap; gap: 5px; margin-top: 5px;">
                                ${company.offers.map(offer => `
                                    <span style="background: #e9ecef; color: #171718; padding: 3px 8px; border-radius: 10px; font-size: 0.8rem;">${offer}</span>
                                `).join('')}
                            </div>
                            <button onclick="manageOffers('${sectorId}', ${index})" style="background: #a3195b; color: white; border: none; padding: 5px 10px; border-radius: 10px; cursor: pointer; font-size: 0.8rem; margin-top: 5px;">
                                Gérer les offres
                            </button>
                        </div>
                    ` : `
                        <button onclick="manageOffers('${sectorId}', ${index})" style="background: #a3195b; color: white; border: none; padding: 5px 10px; border-radius: 10px; cursor: pointer; font-size: 0.8rem; margin-top: 10px;">
                            ➕ Ajouter des offres
                        </button>
                    `}
                    <div style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;">
                        <button onclick="visitCompany('${sectorId}', '${company.name}')" style="background: #95c11f; color: white; border: none; padding: 8px 15px; border-radius: 15px; cursor: pointer; font-weight: 600;">
                            Visiter cette entreprise (+20 pts)
                        </button>
                    </div>
                </div>
            `;
        });
        
        content += '</div>';
    } else {
        content += `
            <div style="text-align: center; padding: 30px; background: #f8f9fa; border-radius: 10px; margin: 20px 0;">
                <div style="font-size: 3rem; margin-bottom: 15px;">🏗️</div>
                <p style="color: #6c757d; margin: 0;">Aucune entreprise dans ce secteur pour le moment.</p>
                <p style="color: #6c757d; margin: 5px 0 0 0;">Clique sur "Ajouter Entreprise" pour commencer !</p>
            </div>
        `;
    }
    
    // Ajouter le secteur aux secteurs visités
    if (!userData.visitedSectors.includes(sectorId)) {
        userData.visitedSectors.push(sectorId);
        addScore(20);
        checkBadges();
        saveUserData();
    }
    
    openModal('Secteur ' + sector.name, content);
}

function visitCompany(sectorId, companyName) {
    addScore(20);
    showNotification(`✅ Entreprise ${companyName} visitée ! +20 points`);
    closeModal();
    saveUserData();
}

function addNewSector() {
    const content = `
        <h3 style="color: #a3195b; margin-bottom: 20px;">➕ Créer un Nouveau Secteur</h3>
        <form onsubmit="createSector(event)" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label for="sectorName" style="display: block; margin-bottom: 5px; font-weight: 600;">Nom du secteur :</label>
                <input type="text" id="sectorName" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: Tourisme, Artisanat...">
            </div>
            <div>
                <label for="sectorIcon" style="display: block; margin-bottom: 5px; font-weight: 600;">Icône du secteur :</label>
                <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 10px 0;">
                    ${['🏢', '⚡', '🎯', '🔧', '📊', '🌟', '💼', '🚀', '⭐', '🎨'].map(icon => `
                        <button type="button" onclick="selectIcon('${icon}')" style="padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; background: white; cursor: pointer; font-size: 1.5rem;" data-icon="${icon}">
                            ${icon}
                        </button>
                    `).join('')}
                </div>
                <input type="hidden" id="selectedIcon" value="🏢">
            </div>
            <div>
                <label for="sectorColor" style="display: block; margin-bottom: 5px; font-weight: 600;">Couleur du secteur :</label>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 10px 0;">
                    ${['#f39200', '#95c11f', '#2897d5', '#a3195b', '#d60b52', '#9f3d3f'].map(color => `
                        <button type="button" onclick="selectColor('${color}')" style="padding: 15px; border: 2px solid #e9ecef; border-radius: 8px; background: ${color}; cursor: pointer;" data-color="${color}">
                        </button>
                    `).join('')}
                </div>
                <input type="hidden" id="selectedColor" value="#f39200">
            </div>
            <button type="submit" style="background: #95c11f; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                Créer le Secteur
            </button>
        </form>
    `;
    
    openModal('Nouveau Secteur', content);
}

function selectIcon(icon) {
    document.querySelectorAll('[data-icon]').forEach(btn => {
        btn.style.border = '2px solid #e9ecef';
    });
    event.target.style.border = '2px solid #f39200';
    document.getElementById('selectedIcon').value = icon;
}

function selectColor(color) {
    document.querySelectorAll('[data-color]').forEach(btn => {
        btn.style.border = '2px solid #e9ecef';
    });
    event.target.style.border = '2px solid #171718';
    document.getElementById('selectedColor').value = color;
}

function createSector(event) {
    event.preventDefault();
    
    const name = document.getElementById('sectorName').value.trim();
    const icon = document.getElementById('selectedIcon').value;
    const color = document.getElementById('selectedColor').value;
    
    if (!name) return;
    
    const id = name.toLowerCase().replace(/\s+/g, '_');
    
    // Vérifier si le secteur existe déjà
    if (appData.sectors.find(s => s.id === id)) {
        showNotification('❌ Ce secteur existe déjà !');
        return;
    }
    
    // Créer le secteur
    appData.sectors.push({
        id,
        name,
        icon,
        color,
        companies: []
    });
    
    saveAppData();
    renderSectors();
    closeModal();
    showNotification(`✅ Secteur "${name}" créé avec succès !`);
}

// =============================================================================
// GESTION DES ENTREPRISES
// =============================================================================

function addCompanyToSector(sectorId) {
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    const content = `
        <h3 style="color: #95c11f; margin-bottom: 20px;">➕ Ajouter une Entreprise</h3>
        <p style="margin-bottom: 20px;">Secteur : <strong>${sector.name}</strong></p>
        <form onsubmit="createCompany(event, '${sectorId}')" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label for="companyName" style="display: block; margin-bottom: 5px; font-weight: 600;">Nom de l'entreprise :</label>
                <input type="text" id="companyName" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: TechCorp, Restaurant Chez Paul...">
            </div>
            <div>
                <label for="companyContact" style="display: block; margin-bottom: 5px; font-weight: 600;">Nom du contact :</label>
                <input type="text" id="companyContact" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: Marie Dupont">
            </div>
            <div>
                <label for="companyPhone" style="display: block; margin-bottom: 5px; font-weight: 600;">Téléphone :</label>
                <input type="tel" id="companyPhone" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: 01.23.45.67.89">
            </div>
            <div>
                <label for="companyEmail" style="display: block; margin-bottom: 5px; font-weight: 600;">Email :</label>
                <input type="email" id="companyEmail" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: contact@entreprise.fr">
            </div>
            <button type="submit" style="background: #95c11f; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
            Ajouter l'Entreprise
            </button>
        </form>
    `;
    
    openModal('Nouvelle Entreprise', content);
}

function createCompany(event, sectorId) {
    event.preventDefault();
    
    const name = document.getElementById('companyName').value.trim();
    const contact = document.getElementById('companyContact').value.trim();
    const phone = document.getElementById('companyPhone').value.trim();
    const email = document.getElementById('companyEmail').value.trim();
    
    if (!name || !contact || !phone || !email) return;
    
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    sector.companies.push({
        name,
        contact,
        phone,
        email,
        offers: []
    });
    
    saveAppData();
    renderSectors();
    closeModal();
    showNotification(`✅ Entreprise "${name}" ajoutée au secteur ${sector.name} !`);
    
    // Rouvrir le secteur pour voir la nouvelle entreprise
    setTimeout(() => openSector(sectorId), 500);
}

function editCompany(sectorId, companyIndex) {
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    const company = sector.companies[companyIndex];
    
    const content = `
        <h3 style="color: #2897d5; margin-bottom: 20px;">✏️ Modifier l'Entreprise</h3>
        <form onsubmit="updateCompany(event, '${sectorId}', ${companyIndex})" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label for="editCompanyName" style="display: block; margin-bottom: 5px; font-weight: 600;">Nom de l'entreprise :</label>
                <input type="text" id="editCompanyName" value="${company.name}" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
            </div>
            <div>
                <label for="editCompanyContact" style="display: block; margin-bottom: 5px; font-weight: 600;">Nom du contact :</label>
                <input type="text" id="editCompanyContact" value="${company.contact}" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
            </div>
            <div>
                <label for="editCompanyPhone" style="display: block; margin-bottom: 5px; font-weight: 600;">Téléphone :</label>
                <input type="tel" id="editCompanyPhone" value="${company.phone}" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
            </div>
            <div>
                <label for="editCompanyEmail" style="display: block; margin-bottom: 5px; font-weight: 600;">Email :</label>
                <input type="email" id="editCompanyEmail" value="${company.email}" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;">
            </div>
            <button type="submit" style="background: #2897d5; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                Sauvegarder les Modifications
            </button>
        </form>
    `;
    
    openModal('Modifier Entreprise', content);
}

function updateCompany(event, sectorId, companyIndex) {
    event.preventDefault();
    
    const name = document.getElementById('editCompanyName').value.trim();
    const contact = document.getElementById('editCompanyContact').value.trim();
    const phone = document.getElementById('editCompanyPhone').value.trim();
    const email = document.getElementById('editCompanyEmail').value.trim();
    
    if (!name || !contact || !phone || !email) return;
    
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    sector.companies[companyIndex] = {
        ...sector.companies[companyIndex],
        name,
        contact,
        phone,
        email
    };
    
    saveAppData();
    closeModal();
    showNotification(`✅ Entreprise "${name}" mise à jour !`);
    
    // Rouvrir le secteur
    setTimeout(() => openSector(sectorId), 500);
}

function deleteCompany(sectorId, companyIndex) {
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    const company = sector.companies[companyIndex];
    
    const content = `
        <h3 style="color: #d60b52; margin-bottom: 20px;">🗑️ Supprimer l'Entreprise</h3>
        <p style="margin-bottom: 20px;">Êtes-vous sûr de vouloir supprimer l'entreprise <strong>"${company.name}"</strong> ?</p>
        <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 20px;">Cette action est irréversible.</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="closeModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                Annuler
            </button>
            <button onclick="confirmDeleteCompany('${sectorId}', ${companyIndex})" style="background: #d60b52; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                Supprimer
            </button>
        </div>
    `;
    
    openModal('Confirmer Suppression', content);
}

function confirmDeleteCompany(sectorId, companyIndex) {
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    const companyName = sector.companies[companyIndex].name;
    sector.companies.splice(companyIndex, 1);
    
    saveAppData();
    renderSectors();
    closeModal();
    showNotification(`🗑️ Entreprise "${companyName}" supprimée !`);
    
    // Rouvrir le secteur
    setTimeout(() => openSector(sectorId), 500);
}

function manageOffers(sectorId, companyIndex) {
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    const company = sector.companies[companyIndex];
    const offers = company.offers || [];
    
    let content = `
        <h3 style="color: #a3195b; margin-bottom: 20px;">💼 Gérer les Offres</h3>
        <p style="margin-bottom: 20px;">Entreprise : <strong>${company.name}</strong></p>
        <div style="margin-bottom: 20px;">
            <h4 style="color: #171718; margin-bottom: 10px;">Offres actuelles :</h4>
    `;
    
    if (offers.length > 0) {
        content += '<div style="display: flex; flex-direction: column; gap: 10px;">';
        offers.forEach((offer, index) => {
            content += `
                <div style="display: flex; justify-content: space-between; align-items: center; background: #f8f9fa; padding: 10px; border-radius: 8px;">
                    <span>${offer}</span>
                    <button onclick="removeOffer('${sectorId}', ${companyIndex}, ${index})" style="background: #d60b52; color: white; border: none; padding: 5px 8px; border-radius: 5px; cursor: pointer; font-size: 0.8rem;">
                        🗑️
                    </button>
                </div>
            `;
        });
        content += '</div>';
    } else {
        content += '<p style="color: #6c757d; font-style: italic;">Aucune offre pour le moment.</p>';
    }
    
    content += `
        </div>
        <form onsubmit="addOffer(event, '${sectorId}', ${companyIndex})" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label for="newOffer" style="display: block; margin-bottom: 5px; font-weight: 600;">Nouvelle offre :</label>
                <input type="text" id="newOffer" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: Développeur Junior, Vendeur H/F...">
            </div>
            <button type="submit" style="background: #95c11f; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                ➕ Ajouter l'Offre
            </button>
        </form>
    `;
    
    openModal('Gérer les Offres', content);
}

function addOffer(event, sectorId, companyIndex) {
    event.preventDefault();
    
    const offerText = document.getElementById('newOffer').value.trim();
    if (!offerText) return;
    
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    if (!sector.companies[companyIndex].offers) {
        sector.companies[companyIndex].offers = [];
    }
    
    sector.companies[companyIndex].offers.push(offerText);
    
    saveAppData();
    showNotification(`✅ Offre "${offerText}" ajoutée !`);
    
    // Recharger le modal
    manageOffers(sectorId, companyIndex);
}

function removeOffer(sectorId, companyIndex, offerIndex) {
    const sector = appData.sectors.find(s => s.id === sectorId);
    if (!sector) return;
    
    const offerText = sector.companies[companyIndex].offers[offerIndex];
    sector.companies[companyIndex].offers.splice(offerIndex, 1);
    
    saveAppData();
    showNotification(`🗑️ Offre "${offerText}" supprimée !`);
    
    // Recharger le modal
    manageOffers(sectorId, companyIndex);
}

// =============================================================================
// GESTION DES OBJECTIFS
// =============================================================================

function completeObjective(objectiveType) {
    if (userData.completedObjectives.includes(objectiveType)) return;
    
    userData.completedObjectives.push(objectiveType);
    
    const objectiveCard = document.getElementById(`obj_${objectiveType}`);
    if (objectiveCard) {
        objectiveCard.classList.add('completed');
        const statusElement = objectiveCard.querySelector('.objective-status');
        if (statusElement) {
            statusElement.textContent = 'Complété !';
        }
    }
    
    let points = 0;
    switch(objectiveType) {
        case 'presence': points = 10; break;
        case 'secteurs': points = 10; break;
        case 'debrief': points = 20; break;
        case 'partenaire': points = 100; break;
    }
    
    addScore(points);
    showNotification(`🎉 Objectif complété ! +${points} points`);
    saveUserData();
}

// =============================================================================
// GESTION DES POINTS ET PROGRESSION
// =============================================================================

function addScore(points) {
    userData.score += points;
    updateAllDisplays();
    checkBadges();
    saveUserData();
}

function updateAllDisplays() {
    // Mettre à jour tous les affichages de score
    const scoreElements = ['totalScore', 'currentScore', 'finalScore'];
    scoreElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.textContent = userData.score;
        }
    });
    
    // Mettre à jour la progression
    const progress = Math.min((userData.score / 1000) * 100, 100);
    const progressElements = ['globalProgress', 'progressBar'];
    progressElements.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.width = progress + '%';
        }
    });
    
    // Mettre à jour le texte de progression
    const progressText = document.getElementById('progressText');
    if (progressText) {
        progressText.textContent = `${Math.round(progress)}% de ton objectif atteint`;
    }
    
    const generalProgress = document.querySelector('[data-translate="general_progress"]');
    if (generalProgress) {
        generalProgress.textContent = `Progression générale : ${Math.round(progress)}%`;
    }
    
    // Mettre à jour les statistiques
    const sectorsCount = document.getElementById('sectorsCount');
    if (sectorsCount) {
        sectorsCount.textContent = userData.visitedSectors.length;
    }
    
    const questionsCount = document.getElementById('questionsCount');
    if (questionsCount) {
        questionsCount.textContent = userData.questionsAsked;
    }
    
    const cvsCount = document.getElementById('cvsCount');
    if (cvsCount) {
        cvsCount.textContent = userData.cvsDeposited;
    }
    
    const badgesCount = document.getElementById('badgesCount');
    if (badgesCount) {
        const totalBadges = Object.values(userData.badges).filter(b => b).length;
        badgesCount.textContent = totalBadges;
    }
}

// =============================================================================
// GESTION DES BADGES
// =============================================================================

function checkBadges() {
    let newBadges = [];
    
    // Badge Explorateur (3 secteurs visités)
    if (userData.visitedSectors.length >= 3 && !userData.badges.explorer) {
        userData.badges.explorer = true;
        newBadges.push('Explorateur');
        addScore(60);
    }
    
    // Badge Communicateur (5 questions posées)
    if (userData.questionsAsked >= 5 && !userData.badges.communicator) {
        userData.badges.communicator = true;
        newBadges.push('Communicateur');
        addScore(250);
    }
    
    // Badge Candidat Pro (3 CV déposés)
    if (userData.cvsDeposited >= 3 && !userData.badges.candidate) {
        userData.badges.candidate = true;
        newBadges.push('Candidat Pro');
        addScore(300);
    }
    
    // Badge Job Hunter (1 contact obtenu)
    if (userData.contactsObtained >= 1 && !userData.badges.hunter) {
        userData.badges.hunter = true;
        newBadges.push('Job Hunter');
        addScore(500);
    }
    
    // Badge Eco Warrior (5000 pas)
    if (userData.stepsCount >= 5000 && !userData.badges.ecoWarrior) {
        userData.badges.ecoWarrior = true;
        newBadges.push('Eco Warrior');
        addScore(150);
    }
    
    if (newBadges.length > 0) {
        newBadges.forEach(badge => {
            showNotification(`🎉 Nouveau badge débloqué : ${badge} !`);
        });
        updateBadgesDisplay();
        updateRewardsBadgesDisplay();
        saveUserData();
    }
}

function updateBadgesDisplay() {
    const container = document.getElementById('badgesDisplay');
    if (!container) return;
    
    const badges = [
        { id: 'explorer', name: 'Explorateur', icon: '🧭', desc: '3 secteurs visités', color: '#95c11f', points: 60 },
        { id: 'communicator', name: 'Communicateur', icon: '💬', desc: '5 questions posées', color: '#2897d5', points: 250 },
        { id: 'candidate', name: 'Candidat Pro', icon: '📄', desc: '3 CV déposés', color: '#f39200', points: 300 },
        { id: 'hunter', name: 'Job Hunter', icon: '🌟', desc: 'Contact obtenu', color: '#a3195b', points: 500 },
        { id: 'ecoWarrior', name: 'Eco Warrior', icon: '🌱', desc: '5000 pas complétés', color: '#95c11f', points: 150 }
    ];
    
    container.innerHTML = '';
    
    badges.forEach(badge => {
        const obtained = userData.badges[badge.id];
        const div = document.createElement('div');
        div.style.cssText = `
            background: ${obtained ? `linear-gradient(135deg, ${badge.color} 0%, ${adjustBrightness(badge.color, -20)} 100%)` : '#f8f9fa'};
            color: ${obtained ? 'white' : '#6c757d'};
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            ${obtained ? '' : 'border: 2px dashed #e9ecef; opacity: 0.6;'}
            position: relative;
        `;
        
        div.innerHTML = `
            ${obtained ? '<div style="position: absolute; top: -10px; right: -10px; background: #ffd700; color: #171718; padding: 5px; border-radius: 50%; font-size: 0.8rem; font-weight: 700;">✓</div>' : ''}
            <div style="font-size: 3rem; margin-bottom: 10px;">${badge.icon}</div>
            <h4 style="margin: 0 0 10px 0;">${badge.name}</h4>
            <p style="margin: 0; font-size: 0.9rem; ${obtained ? 'opacity: 0.9;' : ''}">${badge.desc}</p>
            <div style="background: ${obtained ? 'rgba(255,255,255,0.2)' : '#e9ecef'}; padding: 8px 15px; border-radius: 20px; margin-top: 15px; font-weight: 600;">
                ${obtained ? '✅ Obtenu' : '🔒 Bloqué'}
            </div>
        `;
        
        container.appendChild(div);
    });
}

function updateRewardsBadgesDisplay() {
    const container = document.getElementById('rewardsBadgesDisplay');
    if (!container) return;
    
    const badges = [
        { id: 'explorer', name: 'Explorateur', icon: '🧭', desc: '3 secteurs visités', color: '#95c11f', points: 60 },
        { id: 'communicator', name: 'Communicateur', icon: '💬', desc: '5 questions posées', color: '#2897d5', points: 250 },
        { id: 'candidate', name: 'Candidat Pro', icon: '📄', desc: '3 CV déposés', color: '#f39200', points: 300 },
        { id: 'hunter', name: 'Job Hunter', icon: '🌟', desc: 'Contact obtenu', color: '#a3195b', points: 500 },
        { id: 'ecoWarrior', name: 'Eco Warrior', icon: '🌱', desc: '5000 pas complétés', color: '#95c11f', points: 150 }
    ];
    
    container.innerHTML = '';
    
    badges.forEach(badge => {
        const obtained = userData.badges[badge.id];
        const div = document.createElement('div');
        div.style.cssText = `
            background: ${obtained ? `linear-gradient(135deg, ${badge.color} 0%, ${adjustBrightness(badge.color, -20)} 100%)` : '#f8f9fa'};
            color: ${obtained ? 'white' : '#6c757d'};
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            ${obtained ? '' : 'border: 2px dashed #e9ecef; opacity: 0.6;'}
            position: relative;
        `;
        
        div.innerHTML = `
            ${obtained ? '<div style="position: absolute; top: -10px; right: -10px; background: #ffd700; color: #171718; padding: 5px; border-radius: 50%; font-size: 0.8rem; font-weight: 700;">✓</div>' : ''}
            <div style="font-size: 3rem; margin-bottom: 10px;">${badge.icon}</div>
            <h4 style="margin: 0 0 10px 0;">${badge.name}</h4>
            <p style="margin: 0; font-size: 0.9rem; ${obtained ? 'opacity: 0.9;' : ''}">${badge.desc}</p>
            <div style="background: ${obtained ? 'rgba(255,255,255,0.2)' : '#e9ecef'}; padding: 8px 15px; border-radius: 20px; margin-top: 15px; font-weight: 600;">
                ${obtained ? `+${badge.points} points` : `+${badge.points} points`}
            </div>
        `;
        
        container.appendChild(div);
    });
}

// =============================================================================
// GESTION DES PAS (ECO WARRIOR)
// =============================================================================

function updateSteps() {
    const input = document.getElementById('stepsInput');
    if (!input) return;
    
    const steps = parseInt(input.value) || 0;
    if (steps <= 0) {
        showNotification('❌ Entre un nombre de pas valide !');
        return;
    }
    
    userData.stepsCount = steps;
    
    // Mettre à jour l'affichage
    const stepsCount = document.getElementById('stepsCount');
    if (stepsCount) {
        stepsCount.textContent = steps;
    }
    
    const stepsProgress = document.getElementById('stepsProgress');
    if (stepsProgress) {
        const progress = Math.min((steps / 5000) * 100, 100);
        stepsProgress.style.width = progress + '%';
    }
    
    input.value = '';
    
    showNotification(`✅ ${steps} pas enregistrés !`);
    
    checkBadges();
    saveUserData();
}

// =============================================================================
// CARNET DE BORD
// =============================================================================

function addCompanyToTracker() {
    const content = `
        <h3 style="color: #95c11f; margin-bottom: 20px;">➕ Ajouter une Entreprise au Carnet</h3>
        <form onsubmit="createTrackedCompany(event)" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label for="trackedCompanyName" style="display: block; margin-bottom: 5px; font-weight: 600;">Nom de l'entreprise :</label>
                <input type="text" id="trackedCompanyName" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: TechCorp, Restaurant Chez Paul...">
            </div>
            <div>
                <label for="trackedCompanySector" style="display: block; margin-bottom: 5px; font-weight: 600;">Secteur :</label>
                <input type="text" id="trackedCompanySector" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: Commerce, Industrie, Numérique...">
            </div>
            <div>
                <label for="trackedCompanyContact" style="display: block; margin-bottom: 5px; font-weight: 600;">Contact (optionnel) :</label>
                <input type="text" id="trackedCompanyContact" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="Ex: Marie Dupont">
            </div>
            <button type="submit" style="background: #95c11f; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                Ajouter au Carnet
            </button>
        </form>
    `;
    
    openModal('Nouvelle Entreprise', content);
}

function createTrackedCompany(event) {
    event.preventDefault();
    
    const name = document.getElementById('trackedCompanyName').value.trim();
    const sector = document.getElementById('trackedCompanySector').value.trim();
    const contact = document.getElementById('trackedCompanyContact').value.trim();
    
    if (!name) return;
    
    const newCompany = {
        id: Date.now(),
        name: name,
        sector: sector || 'Non spécifié',
        contact: contact || '',
        presentation: false,
        question: false,
        cv: false,
        suivi: false,
        ressenti: '',
        comment: ''
    };
    
    userData.companyTracker.push(newCompany);
    
    updateTrackerDisplay();
    closeModal();
    showNotification(`✅ Entreprise "${name}" ajoutée au carnet !`);
    saveUserData();
}

function updateTrackerDisplay() {
    const trackerBody = document.getElementById('trackerBody');
    const emptyTracker = document.getElementById('emptyTracker');
    
    if (!trackerBody || !emptyTracker) return;
    
    if (userData.companyTracker.length === 0) {
        emptyTracker.style.display = 'block';
        document.getElementById('companyTracker').style.display = 'none';
        return;
    }
    
    emptyTracker.style.display = 'none';
    document.getElementById('companyTracker').style.display = 'table';
    
    trackerBody.innerHTML = '';
    
    userData.companyTracker.forEach((company, index) => {
        const row = document.createElement('tr');
        row.style.cssText = `
            background: ${index % 2 === 0 ? 'white' : '#f8f9fa'};
            border-bottom: 1px solid #e9ecef;
            transition: all 0.3s ease;
        `;
        
        row.innerHTML = `
            <td style="padding: 15px; border-right: 1px solid #e9ecef;">
                <div style="font-weight: 600; color: #171718; margin-bottom: 5px;">${company.name}</div>
                <div style="font-size: 0.9rem; color: #6c757d;">${company.sector}</div>
                ${company.contact ? `<div style="font-size: 0.8rem; color: #6c757d; margin-top: 3px;">${company.contact}</div>` : ''}
            </td>
            <td style="padding: 15px; text-align: center; border-right: 1px solid #e9ecef;">
                <label style="cursor: pointer; display: inline-block;">
                    <input type="checkbox" ${company.presentation ? 'checked' : ''} onchange="updateCompanyStatus(${company.id}, 'presentation', this.checked)" style="display: none;">
                    <div class="checkbox-custom" style="width: 35px; height: 35px; border: 3px solid ${company.presentation ? '#95c11f' : '#e9ecef'}; border-radius: 10px; background: ${company.presentation ? 'linear-gradient(135deg, #95c11f 0%, #7ba518 100%)' : 'white'}; display: flex; align-items: center; justify-content: center; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); margin: 0 auto; box-shadow: ${company.presentation ? '0 6px 20px rgba(149,193,31,0.4)' : '0 2px 8px rgba(0,0,0,0.1)'}; transform: ${company.presentation ? 'scale(1.1)' : 'scale(1)'};">
                        ${company.presentation ? '<span style="color: white; font-weight: bold; font-size: 1.2rem;">✓</span>' : ''}
                    </div>
                </label>
            </td>
            <td style="padding: 15px; text-align: center; border-right: 1px solid #e9ecef;">
                <label style="cursor: pointer; display: inline-block;">
                    <input type="checkbox" ${company.question ? 'checked' : ''} onchange="updateCompanyStatus(${company.id}, 'question', this.checked)" style="display: none;">
                    <div class="checkbox-custom" style="width: 35px; height: 35px; border: 3px solid ${company.question ? '#95c11f' : '#e9ecef'}; border-radius: 10px; background: ${company.question ? 'linear-gradient(135deg, #95c11f 0%, #7ba518 100%)' : 'white'}; display: flex; align-items: center; justify-content: center; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); margin: 0 auto; box-shadow: ${company.question ? '0 6px 20px rgba(149,193,31,0.4)' : '0 2px 8px rgba(0,0,0,0.1)'}; transform: ${company.question ? 'scale(1.1)' : 'scale(1)'};">
                        ${company.question ? '<span style="color: white; font-weight: bold; font-size: 1.2rem;">✓</span>' : ''}
                    </div>
                </label>
            </td>
            <td style="padding: 15px; text-align: center; border-right: 1px solid #e9ecef;">
                <label style="cursor: pointer; display: inline-block;">
                    <input type="checkbox" ${company.cv ? 'checked' : ''} onchange="updateCompanyStatus(${company.id}, 'cv', this.checked)" style="display: none;">
                    <div class="checkbox-custom" style="width: 35px; height: 35px; border
                    : 3px solid ${company.cv ? '#95c11f' : '#e9ecef'}; border-radius: 10px; background: ${company.cv ? 'linear-gradient(135deg, #95c11f 0%, #7ba518 100%)' : 'white'}; display: flex; align-items: center; justify-content: center; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); margin: 0 auto; box-shadow: ${company.cv ? '0 6px 20px rgba(149,193,31,0.4)' : '0 2px 8px rgba(0,0,0,0.1)'}; transform: ${company.cv ? 'scale(1.1)' : 'scale(1)'};">
                        ${company.cv ? '<span style="color: white; font-weight: bold; font-size: 1.2rem;">✓</span>' : ''}
                    </div>
                </label>
            </td>
            <td style="padding: 15px; text-align: center; border-right: 1px solid #e9ecef;">
                <label style="cursor: pointer; display: inline-block;">
                    <input type="checkbox" ${company.suivi ? 'checked' : ''} onchange="updateCompanyStatus(${company.id}, 'suivi', this.checked)" style="display: none;">
                    <div class="checkbox-custom" style="width: 35px; height: 35px; border: 3px solid ${company.suivi ? '#95c11f' : '#e9ecef'}; border-radius: 10px; background: ${company.suivi ? 'linear-gradient(135deg, #95c11f 0%, #7ba518 100%)' : 'white'}; display: flex; align-items: center; justify-content: center; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); margin: 0 auto; box-shadow: ${company.suivi ? '0 6px 20px rgba(149,193,31,0.4)' : '0 2px 8px rgba(0,0,0,0.1)'}; transform: ${company.suivi ? 'scale(1.1)' : 'scale(1)'};">
                        ${company.suivi ? '<span style="color: white; font-weight: bold; font-size: 1.2rem;">✓</span>' : ''}
                    </div>
                </label>
            </td>
            <td style="padding: 15px; text-align: center; border-right: 1px solid #e9ecef;">
                <div style="display: flex; align-items: center; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <div style="display: flex; gap: 5px;">
                        <button onclick="setFeeling(${company.id}, '😊')" style="background: ${company.ressenti === '😊' ? 'linear-gradient(135deg, #95c11f 0%, #7ba518 100%)' : '#f8f9fa'}; border: 2px solid ${company.ressenti === '😊' ? '#95c11f' : '#e9ecef'}; border-radius: 50%; width: 38px; height: 38px; cursor: pointer; font-size: 1.3rem; transition: all 0.3s ease; color: ${company.ressenti === '😊' ? 'white' : '#171718'}; box-shadow: ${company.ressenti === '😊' ? '0 4px 15px rgba(149,193,31,0.3)' : 'none'};">😊</button>
                        <button onclick="setFeeling(${company.id}, '🙂')" style="background: ${company.ressenti === '🙂' ? 'linear-gradient(135deg, #2897d5 0%, #1e7bb8 100%)' : '#f8f9fa'}; border: 2px solid ${company.ressenti === '🙂' ? '#2897d5' : '#e9ecef'}; border-radius: 50%; width: 38px; height: 38px; cursor: pointer; font-size: 1.3rem; transition: all 0.3s ease; color: ${company.ressenti === '🙂' ? 'white' : '#171718'}; box-shadow: ${company.ressenti === '🙂' ? '0 4px 15px rgba(40,151,213,0.3)' : 'none'};">🙂</button>
                        <button onclick="setFeeling(${company.id}, '😐')" style="background: ${company.ressenti === '😐' ? 'linear-gradient(135deg, #f39200 0%, #d17a00 100%)' : '#f8f9fa'}; border: 2px solid ${company.ressenti === '😐' ? '#f39200' : '#e9ecef'}; border-radius: 50%; width: 38px; height: 38px; cursor: pointer; font-size: 1.3rem; transition: all 0.3s ease; color: ${company.ressenti === '😐' ? 'white' : '#171718'}; box-shadow: ${company.ressenti === '😐' ? '0 4px 15px rgba(243,146,0,0.3)' : 'none'};">😐</button>
                        <button onclick="setFeeling(${company.id}, '😕')" style="background: ${company.ressenti === '😕' ? 'linear-gradient(135deg, #d60b52 0%, #b8094a 100%)' : '#f8f9fa'}; border: 2px solid ${company.ressenti === '😕' ? '#d60b52' : '#e9ecef'}; border-radius: 50%; width: 38px; height: 38px; cursor: pointer; font-size: 1.3rem; transition: all 0.3s ease; color: ${company.ressenti === '😕' ? 'white' : '#171718'}; box-shadow: ${company.ressenti === '😕' ? '0 4px 15px rgba(214,11,82,0.3)' : 'none'};">😕</button>
                    </div>
                    <button onclick="addComment(${company.id})" style="background: #2897d5; color: white; border: none; padding: 5px 10px; border-radius: 15px; cursor: pointer; font-size: 0.8rem; font-weight: 600;">✏️</button>
                </div>
                ${company.comment ? `<div style="background: #f8f9fa; padding: 8px; border-radius: 8px; margin-top: 8px; font-size: 0.8rem; color: #6c757d; text-align: left;">${company.comment}</div>` : ''}
            </td>
            <td style="padding: 15px; text-align: center;">
                <button onclick="removeTrackedCompany(${company.id})" style="background: #d60b52; color: white; border: none; padding: 8px; border-radius: 50%; cursor: pointer; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                    🗑️
                </button>
            </td>
        `;
        
        trackerBody.appendChild(row);
    });
}

function updateCompanyStatus(companyId, field, value) {
    const company = userData.companyTracker.find(c => c.id === companyId);
    if (!company) return;
    
    company[field] = value;
    
    // Ajouter des points selon l'action
    if (value) {
        let points = 0;
        switch(field) {
            case 'presentation': 
                points = 20; 
                break;
            case 'question': 
                points = 50; 
                userData.questionsAsked++;
                break;
            case 'cv': 
                points = 100; 
                userData.cvsDeposited++;
                break;
            case 'suivi': 
                points = 200; 
                userData.contactsObtained++;
                break;
        }
        
        if (points > 0) {
            addScore(points);
            const actionName = {
                'presentation': 'la présentation',
                'question': 'la question posée',
                'cv': 'le CV déposé',
                'suivi': 'le suivi obtenu'
            }[field];
            showNotification(`🎉 +${points} points pour ${actionName} !`);
        }
    } else {
        // Retirer le compteur si décoché
        switch(field) {
            case 'question': 
                userData.questionsAsked = Math.max(0, userData.questionsAsked - 1);
                break;
            case 'cv': 
                userData.cvsDeposited = Math.max(0, userData.cvsDeposited - 1);
                break;
            case 'suivi': 
                userData.contactsObtained = Math.max(0, userData.contactsObtained - 1);
                break;
        }
    }
    
    updateTrackerDisplay();
    updateAllDisplays();
    checkBadges();
    saveUserData();
}

function setFeeling(companyId, feeling) {
    const company = userData.companyTracker.find(c => c.id === companyId);
    if (!company) return;
    
    company.ressenti = company.ressenti === feeling ? '' : feeling;
    updateTrackerDisplay();
    saveUserData();
}

function addComment(companyId) {
    const company = userData.companyTracker.find(c => c.id === companyId);
    if (!company) return;
    
    const content = `
        <h3 style="color: #2897d5; margin-bottom: 20px;">✏️ Commentaire - ${company.name}</h3>
        <form onsubmit="saveComment(event, ${companyId})" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label for="companyComment" style="display: block; margin-bottom: 5px; font-weight: 600;">Ton ressenti / commentaire :</label>
                <textarea id="companyComment" rows="4" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem; resize: vertical;" placeholder="Ex: Très bon accueil, poste intéressant, à recontacter la semaine prochaine...">${company.comment || ''}</textarea>
            </div>
            <button type="submit" style="background: #2897d5; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                Sauvegarder
            </button>
        </form>
    `;
    
    openModal('Ajouter un Commentaire', content);
}

function saveComment(event, companyId) {
    event.preventDefault();
    
    const comment = document.getElementById('companyComment').value.trim();
    const company = userData.companyTracker.find(c => c.id === companyId);
    
    if (company) {
        company.comment = comment;
        updateTrackerDisplay();
        closeModal();
        showNotification('💬 Commentaire sauvegardé !');
        saveUserData();
    }
}

function removeTrackedCompany(companyId) {
    const company = userData.companyTracker.find(c => c.id === companyId);
    if (!company) return;
    
    const content = `
        <h3 style="color: #d60b52; margin-bottom: 20px;">🗑️ Supprimer l'Entreprise</h3>
        <p style="margin-bottom: 20px;">Êtes-vous sûr de vouloir supprimer <strong>"${company.name}"</strong> de votre carnet de bord ?</p>
        <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 20px;">Cette action est irréversible.</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="closeModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                Annuler
            </button>
            <button onclick="confirmRemoveTrackedCompany(${companyId})" style="background: #d60b52; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                Supprimer
            </button>
        </div>
    `;
    
    openModal('Confirmer Suppression', content);
}

function confirmRemoveTrackedCompany(companyId) {
    userData.companyTracker = userData.companyTracker.filter(c => c.id !== companyId);
    updateTrackerDisplay();
    updateAllDisplays();
    closeModal();
    showNotification('🗑️ Entreprise supprimée du carnet !');
    saveUserData();
}

function clearAllTracking() {
    if (userData.companyTracker.length === 0) {
        showNotification('📝 Le carnet est déjà vide !');
        return;
    }
    
    const content = `
        <h3 style="color: #d60b52; margin-bottom: 20px;">🗑️ Effacer Tout le Carnet</h3>
        <p style="margin-bottom: 20px;">Êtes-vous sûr de vouloir supprimer <strong>toutes les entreprises</strong> de votre carnet de bord ?</p>
        <p style="color: #6c757d; font-size: 0.9rem; margin-bottom: 20px;">Cette action supprimera définitivement ${userData.companyTracker.length} entreprise(s) et tous les commentaires associés.</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button onclick="closeModal()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                Annuler
            </button>
            <button onclick="confirmClearAllTracking()" style="background: #d60b52; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                Tout Effacer
            </button>
        </div>
    `;
    
    openModal('Confirmer Suppression', content);
}

function confirmClearAllTracking() {
    userData.companyTracker = [];
    updateTrackerDisplay();
    updateAllDisplays();
    closeModal();
    showNotification('🗑️ Carnet de bord effacé !');
    saveUserData();
}

// =============================================================================
// GESTION DES QUESTIONS
// =============================================================================

function renderQuestions() {
    const grid = document.getElementById('questionsGrid');
    if (!grid) return;
    
    grid.innerHTML = '';
    
    appData.predefinedQuestions.forEach((question, index) => {
        const card = document.createElement('div');
        card.className = 'question-card-colorful';
        card.style.cssText = `
            background: linear-gradient(135deg, ${question.color} 0%, ${adjustBrightness(question.color, -20)} 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px ${question.color}50;
        `;
        card.onclick = () => copyQuestion(question.text);
        
        card.innerHTML = `
            <div style="font-size: 2.5rem; margin-bottom: 10px;">${question.icon}</div>
            <h4 style="margin: 0; font-size: 1.1rem; font-weight: 600;">${question.text}</h4>
        `;
        
        grid.appendChild(card);
    });
}

function copyQuestion(question) {
    if (navigator.clipboard) {
        navigator.clipboard.writeText(question).then(() => {
            showNotification(`📋 Question copiée : "${question}"`);
        }).catch(() => {
            showNotification(`💡 Question sélectionnée : "${question}"`);
        });
    } else {
        showNotification(`💡 Question sélectionnée : "${question}"`);
    }
    
    // Effet visuel
    if (event.target.closest('.question-card-colorful')) {
        event.target.closest('.question-card-colorful').style.transform = 'scale(0.95)';
        setTimeout(() => {
            event.target.closest('.question-card-colorful').style.transform = 'scale(1)';
        }, 150);
    }
}

function addPersonalQuestion() {
    const input = document.getElementById('newPersonalQuestion');
    const question = input.value.trim();
    
    if (!question) {
        showNotification('❌ Écris d\'abord ta question !');
        return;
    }
    
    userData.personalQuestions.push({
        id: Date.now(),
        text: question
    });
    
    input.value = '';
    updatePersonalQuestionsDisplay();
    showNotification('✅ Question personnelle ajoutée !');
    saveUserData();
}

function updatePersonalQuestionsDisplay() {
    const container = document.getElementById('personalQuestions');
    if (!container) return;
    
    if (userData.personalQuestions.length === 0) {
        container.innerHTML = '<p style="color: #6c757d; font-style: italic; margin: 0;">Aucune question personnelle pour le moment.</p>';
        return;
    }
    
    container.innerHTML = '';
    
    userData.personalQuestions.forEach((question) => {
        const questionDiv = document.createElement('div');
        questionDiv.style.cssText = `
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 10px;
            border-left: 4px solid #f39200;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        `;
        
        questionDiv.innerHTML = `
            <span style="color: #171718; flex: 1;">${question.text}</span>
            <div style="display: flex; gap: 8px;">
                <button onclick="copyQuestion('${question.text.replace(/'/g, '\\\'')}')" style="background: #2897d5; color: white; border: none; padding: 6px 10px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; font-weight: 600;">
                    📋 Copier
                </button>
                <button onclick="removePersonalQuestion(${question.id})" style="background: #d60b52; color: white; border: none; padding: 6px 8px; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">
                    🗑️
                </button>
            </div>
        `;
        
        container.appendChild(questionDiv);
    });
}

function removePersonalQuestion(questionId) {
    userData.personalQuestions = userData.personalQuestions.filter(q => q.id !== questionId);
    updatePersonalQuestionsDisplay();
    showNotification('🗑️ Question supprimée !');
    saveUserData();
}

// =============================================================================
// PROCHAINS OBJECTIFS
// =============================================================================

function updateNextObjectives() {
    const container = document.getElementById('nextObjectives');
    if (!container) return;
    
    container.innerHTML = '';
    
    const objectives = [];
    
    // Objectif Explorateur
    if (!userData.badges.explorer) {
        const remaining = Math.max(0, 3 - userData.visitedSectors.length);
        objectives.push({
            icon: '🧭',
            title: `Visite ${remaining} secteur${remaining > 1 ? 's' : ''} de plus`,
            desc: 'Pour débloquer le badge Explorateur'
        });
    }
    
    // Objectif Communicateur
    if (!userData.badges.communicator) {
        const remaining = Math.max(0, 5 - userData.questionsAsked);
        objectives.push({
            icon: '💬',
            title: `Pose ${remaining} question${remaining > 1 ? 's' : ''} de plus`,
            desc: 'Pour débloquer le badge Communicateur'
        });
    }
    
    // Objectif Candidat Pro
    if (!userData.badges.candidate) {
        const remaining = Math.max(0, 3 - userData.cvsDeposited);
        objectives.push({
            icon: '📄',
            title: `Dépose ${remaining} CV de plus`,
            desc: 'Pour débloquer le badge Candidat Pro'
        });
    }
    
    // Objectif Job Hunter
    if (!userData.badges.hunter) {
        objectives.push({
            icon: '🌟',
            title: 'Obtiens un contact ou entretien',
            desc: 'Pour débloquer le badge Job Hunter'
        });
    }
    
    // Objectif Eco Warrior
    if (!userData.badges.ecoWarrior) {
        const remaining = Math.max(0, 5000 - userData.stepsCount);
        objectives.push({
            icon: '🌱',
            title: `Marche ${remaining} pas de plus`,
            desc: 'Pour débloquer le badge Eco Warrior'
        });
    }
    
    if (objectives.length === 0) {
        container.innerHTML = `
            <div style="background: rgba(255,255,255,0.1); padding: 20px; border-radius: 15px; text-align: center; grid-column: 1 / -1;">
                <div style="font-size: 3rem; margin-bottom: 10px;">🎉</div>
                <h4 style="margin: 0;">Félicitations !</h4>
                <p style="margin: 10px 0 0 0;">Tu as débloqué tous les badges !</p>
            </div>
        `;
    } else {
        objectives.forEach(obj => {
            const div = document.createElement('div');
            div.style.cssText = `
                background: rgba(255,255,255,0.1);
                padding: 20px;
                border-radius: 15px;
            `;
            div.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 10px;">${obj.icon}</div>
                <h4 style="margin: 0 0 10px 0;">${obj.title}</h4>
                <p style="margin: 0; font-size: 0.9rem; opacity: 0.9;">${obj.desc}</p>
            `;
            container.appendChild(div);
        });
    }
}

// =============================================================================
// MODAL
// =============================================================================

function openModal(title, content) {
    document.getElementById('modalTitle').textContent = title;
    document.getElementById('modalContent').innerHTML = content;
    document.getElementById('modal').classList.add('active');
}

function closeModal() {
    document.getElementById('modal').classList.remove('active');
}

// Fermer le modal avec Echap
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        closeModal();
    }
});

// Fermer le modal en cliquant à l'extérieur
document.getElementById('modal').addEventListener('click', function(event) {
    if (event.target === this) {
        closeModal();
    }
});

// =============================================================================
// AUTRES FONCTIONS
// =============================================================================

function openQG() {
    const content = `
        <h3 style="color: #2897d5; margin-bottom: 20px;">🏠 QG Mission Locale</h3>
        <p style="margin-bottom: 20px;">Bienvenue au stand de la Mission Locale ! Nous sommes là pour t'accompagner.</p>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
            <h4 style="color: #f39200; margin: 0 0 15px 0;">📋 Tes objectifs du jour :</h4>
            <ul style="margin: 0; padding-left: 20px; color: #171718;">
                <li>Signer la feuille de présence ${userData.completedObjectives.includes('presence') ? '✅' : ''}</li>
                <li>Explorer au moins 3 secteurs (${userData.visitedSectors.length}/3)</li>
                <li>Poser des questions aux recruteurs</li>
                <li>Déposer ton CV dans une entreprise</li>
                <li>Revenir ici pour le débrief final</li>
            </ul>
        </div>
        <div style="background: linear-gradient(135deg, #95c11f 0%, #2897d5 100%); color: white; padding: 15px; border-radius: 10px; text-align: center;">
            <p style="margin: 0; font-weight: 600;">💬 Besoin d'aide ? N'hésite pas à nous poser tes questions !</p>
        </div>
    `;
    
    openModal('QG Mission Locale', content);
}

function openCVOptions() {
    const content = `
        <h3 style="color: #f39200; margin-bottom: 20px;">📄 Mon CV</h3>
        <p style="margin-bottom: 20px;">Choisis comment tu veux partager ton CV avec les recruteurs :</p>
        <div style="display: flex; flex-direction: column; gap: 15px;">
            <button onclick="downloadCV()" style="background: #2897d5; color: white; border: none; padding: 15px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                ⬇️ Télécharger mon CV (PDF)
            </button>
            <button onclick="emailCV()" style="background: #95c11f; color: white; border: none; padding: 15px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                📧 Envoyer mon CV par email
            </button>
            <button onclick="shareCV()" style="background: #f39200; color: white; border: none; padding: 15px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                🔗 Partager le lien de mon CV
            </button>
        </div>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-top: 20px;">
            <p style="margin: 0; font-size: 0.9rem; color: #6c757d; text-align: center;">
                💡 Conseil : Dépose ton CV dans les entreprises qui t'intéressent pour gagner +100 points !
            </p>
        </div>
    `;
    
    openModal('Mon CV', content);
}

function downloadCV() {
    showNotification('📄 CV téléchargé !');
    closeModal();
}

function emailCV() {
    showNotification('📧 CV envoyé par email !');
    closeModal();
}

function shareCV() {
    showNotification('🔗 Lien du CV copié !');
    closeModal();
}

function openChat() {
    showPage('questions');
    closeModal();
}

function downloadBilan() {
    showNotification('📊 Bilan personnalisé téléchargé en PDF !');
}

function emailBilan() {
    const content = `
        <h3 style="color: #2897d5; margin-bottom: 20px;">📧 Envoyer le Bilan par Email</h3>
        <form onsubmit="sendBilanEmail(event)" style="display: flex; flex-direction: column; gap: 15px;">
            <div>
                <label for="emailAddress" style="display: block; margin-bottom: 5px; font-weight: 600;">Adresse email :</label>
                <input type="email" id="emailAddress" required style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 1rem;" placeholder="ton.email@exemple.fr">
            </div>
            <button type="submit" style="background: #2897d5; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;">
                📧 Envoyer le Bilan
            </button>
        </form>
    `;
    
    openModal('Envoyer par Email', content);
}

function sendBilanEmail(event) {
    event.preventDefault();
    const email = document.getElementById('emailAddress').value;
    closeModal();
    showNotification(`📧 Bilan envoyé à ${email} !`);
}

function saveResults() {
    const content = `
        <h3 style="color: #f39200; margin-bottom: 20px;">💾 Sauvegarder Mon Résultat</h3>
        <p style="margin-bottom: 20px;">Tes résultats sont automatiquement sauvegardés dans ton navigateur !</p>
        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px;">
            <h4 style="color: #171718; margin: 0 0 10px 0;">📋 Résumé :</h4>
            <ul style="margin: 0; padding-left: 20px; color: #6c757d; font-size: 0.9rem;">
                <li>Score final : ${userData.score} points</li>
                <li>Badges obtenus : ${Object.values(userData.badges).filter(b => b).length}/5</li>
                <li>Secteurs visités : ${userData.visitedSectors.length}</li>
                <li>Entreprises contactées : ${userData.companyTracker.length}</li>
            </ul>
        </div>
        <button onclick="downloadBilan()" style="background: #f39200; color: white; border: none; padding: 12px 20px; border-radius: 10px; cursor: pointer; font-weight: 600; margin-top: 20px; width: 100%;">
            📄 Télécharger le rapport PDF
        </button>
    `;
    
    openModal('Sauvegarder Résultats', content);
}

// =============================================================================
// NOTIFICATIONS
// =============================================================================

function showNotification(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: linear-gradient(135deg, #95c11f 0%, #2897d5 100%);
        color: white;
        padding:
        15px 20px;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        z-index: 2000;
        font-weight: 600;
        animation: slideIn 0.3s ease-out;
        max-width: 300px;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// =============================================================================
// TRADUCTION
// =============================================================================

function changeLanguage(lang) {
    currentLanguage = lang;
    
    // Mettre à jour les boutons de langue
    document.getElementById('langFr').style.cssText = lang === 'fr' ?
        "background: linear-gradient(135deg, #f39200 0%, #d17a00 100%); color: white; border: 2px solid #171718; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(243,146,0,0.3);" :
        "background: rgba(255,255,255,0.9); color: #171718; border: 2px solid #171718; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1);";
    
    document.getElementById('langEs').style.cssText = lang === 'es' ?
        "background: linear-gradient(135deg, #f39200 0%, #d17a00 100%); color: white; border: 2px solid #171718; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(243,146,0,0.3);" :
        "background: rgba(255,255,255,0.9); color: #171718; border: 2px solid #171718; padding: 8px 12px; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 0.9rem; transition: all 0.3s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.1);";
    
    // Appliquer les traductions
    const elementsToTranslate = document.querySelectorAll('[data-translate]');
    elementsToTranslate.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    showNotification(lang === 'es' ? '🇪🇸 Idioma cambiado a español' : '🇫🇷 Langue changée en français');
}

// =============================================================================
// STYLES ADDITIONNELS
// =============================================================================

// Ajouter les animations CSS
const style = document.createElement('style');
style.textContent = `
    @keyframes slideIn {
        from {
            transform: translateX(400px);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }
    
    @keyframes slideOut {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(400px);
            opacity: 0;
        }
    }
    
    .checkbox-custom:hover {
        transform: scale(1.15) !important;
        box-shadow: 0 8px 25px rgba(149,193,31,0.5) !important;
    }
    
    button:hover {
        transform: translateY(-2px) !important;
    }
    
    .question-card-colorful:hover {
        transform: translateY(-5px) scale(1.05);
        box-shadow: 0 12px 30px rgba(0,0,0,0.3) !important;
    }
    
    .sector-card:hover {
        transform: translateY(-5px);
    }
    
    /* Style pour le scrollbar */
    ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }
    
    ::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, #f39200 0%, #95c11f 100%);
        border-radius: 5px;
    }
    
    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, #d17a00 0%, #7ba518 100%);
    }
    
    /* Animations pour les inputs */
    input:focus, textarea:focus {
        outline: none;
        border-color: #f39200 !important;
        box-shadow: 0 0 0 3px rgba(243, 146, 0, 0.1);
    }
    
    /* Animation de chargement */
    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }
    
    .stat-pulse {
        animation: pulse 0.6s ease-in-out;
    }
    
    /* Style responsive pour les tableaux */
    @media (max-width: 768px) {
        #companyTracker {
            font-size: 0.85rem;
        }
        
        #companyTracker th,
        #companyTracker td {
            padding: 10px 8px !important;
        }
        
        .checkbox-custom {
            width: 30px !important;
            height: 30px !important;
        }
        
        button {
            font-size: 0.85rem !important;
        }
    }
`;
document.head.appendChild(style);

// =============================================================================
// INITIALISATION FINALE
// =============================================================================

// Charger les questions personnelles au démarrage
window.addEventListener('load', function() {
    updatePersonalQuestionsDisplay();
    
    // Marquer la présence automatiquement après 2 secondes
    setTimeout(() => {
        if (!userData.completedObjectives.includes('presence')) {
            completeObjective('presence');
        }
    }, 2000);
});

// Sauvegarder avant de quitter la page
window.addEventListener('beforeunload', function() {
    saveUserData();
    saveAppData();
});

// =============================================================================
// FONCTIONS D'EXPORT / DEBUG
// =============================================================================

// Fonction pour exporter toutes les données (utile pour le debug)
function exportAllData() {
    const data = {
        userData: userData,
        appData: appData,
        exportDate: new Date().toISOString()
    };
    
    const dataStr = JSON.stringify(data, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    
    const link = document.createElement('a');
    link.href = url;
    link.download = `game-of-jobs-export-${Date.now()}.json`;
    link.click();
    
    URL.revokeObjectURL(url);
    showNotification('📥 Données exportées avec succès !');
}

// Fonction pour importer des données (utile pour le debug)
function importData(jsonData) {
    try {
        const data = JSON.parse(jsonData);
        if (data.userData) {
            userData = data.userData;
            saveUserData();
        }
        if (data.appData) {
            appData = data.appData;
            saveAppData();
        }
        
        initializeApp();
        showNotification('📤 Données importées avec succès !');
    } catch (e) {
        console.error('Erreur lors de l\'import:', e);
        showNotification('❌ Erreur lors de l\'import des données');
    }
}

// Fonction pour réinitialiser toutes les données
function resetAllData() {
    if (confirm('⚠️ ATTENTION : Cette action va supprimer TOUTES tes données (score, badges, carnet de bord, etc.). Es-tu sûr de vouloir continuer ?')) {
        localStorage.removeItem('gameOfJobsUserData');
        localStorage.removeItem('gameOfJobsAppData');
        location.reload();
    }
}

// Ajouter ces fonctions au contexte global pour debug en console
window.gameOfJobs = {
    exportAllData,
    importData,
    resetAllData,
    getUserData: () => userData,
    getAppData: () => appData,
    addScore: (points) => addScore(points),
    unlockBadge: (badgeId) => {
        if (userData.badges[badgeId] !== undefined) {
            userData.badges[badgeId] = true;
            checkBadges();
            updateBadgesDisplay();
        }
    }
};

console.log('%c🎮 GAME OF JOBS', 'color: #f39200; font-size: 20px; font-weight: bold;');
console.log('%cApplication chargée avec succès !', 'color: #95c11f; font-size: 14px;');
console.log('%cUtilise window.gameOfJobs pour accéder aux fonctions de debug', 'color: #2897d5; font-size: 12px;');
console.log('Exemples:');
console.log('  - window.gameOfJobs.getUserData() : Voir les données utilisateur');
console.log('  - window.gameOfJobs.addScore(100) : Ajouter 100 points');
console.log('  - window.gameOfJobs.exportAllData() : Exporter toutes les données');
console.log('  - window.gameOfJobs.resetAllData() : Réinitialiser tout');

</script>
</body>
</html>
